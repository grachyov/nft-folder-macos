<!--
Copyright (c) 2024 LG Electronics Inc.

SPDX-License-Identifier: Apache-2.0
-->

<!DOCTYPE html>
<html>

<head>
	<title>new app</title>
	<style type="text/css">
		body {
			width: 100%;
			height: 100%;
			background-color: #202020;
			margin: 0;
			padding: 0;
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
		}

		.container {
			position: relative;
			width: 100%;
			height: 100%;
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
		}

		iframe {
			width: 420px;
			height: 420px;
			border: none;
		}

		.text-container {
			position: absolute;
			top: 10px;
			left: 10px;
			display: flex;
			flex-direction: column;
			align-items: flex-start;
		}

		h1 {
			color: #FFFFFF;
			margin: 5px 0;
		}

	</style>
</head>

<script src="webOSTVjs-1.2.10/webOSTV.js" charset="utf-8"></script>
<script src="webOSTVjs-1.2.10/webOSTV-dev.js" charset="utf-8"></script>
<script type="text/javascript">
	//sample code for calling LS2 API
	webOS.service.request("luna://com.palm.systemservice", {
		method: "clock/getTime",
		parameters: {},
		onSuccess: function (args) {
			console.log("UTC:", args.utc);
		},
		onFailure: function (args) {
			console.log("Failed to getTime");
		}
	});

	document.addEventListener(
		"webOSLaunch",
		function (inData) {
			var launchElement = document.getElementById("launch");
			launchElement.innerHTML = "App Launched";
		},
		true
	);

	document.addEventListener(
		"webOSRelaunch",
		function (inData) {
			var launchElement = document.getElementById("reLaunch");
			launchElement.innerHTML = "App Relaunched";
		},
		true
	);

	var hidden, visibilityChange;
	if (typeof document.hidden !== "undefined") {
		hidden = "hidden";
		visibilityChange = "visibilitychange";
	} else if (typeof document.webkitHidden !== "undefined") {
		hidden = "webkitHidden";
		visibilityChange = "webkitvisibilitychange";
	}

	let createIframeTimeout;

	document.addEventListener(
		visibilityChange,
		function () {
			if (document[hidden]) {
				var visibilityElement = document.getElementById("visibility");
				visibilityElement.innerHTML = "App Hidden";
				removeIframe();
				if (createIframeTimeout) {
					clearTimeout(createIframeTimeout);
				}
			} else {
				var visibilityElement = document.getElementById("visibility");
				visibilityElement.innerHTML = "App Shown";
				createIframeTimeout = setTimeout(() => {
					createIframe();
				}, 2300);
			}
		},
		true
	);

	function updateIframeContent() {
		var iframe = document.getElementById('colorFrame');
		if (iframe) {
			fetch('sample.html')
				.then(response => response.text())
				.then(content => {
					iframe.srcdoc = content;
				})
				.catch(() => {});
		}
	}

	function removeIframe() {
		var iframe = document.getElementById('colorFrame');
		isShowingPlayer = false;
		if (iframe) {
			iframe.remove();
		}
	}

	var isShowingPlayer = false;

	function createIframe() {
		if (isShowingPlayer) { return; }
		if (document[hidden]) { return; }
		var container = document.querySelector('.container');
		if (!container) { return; }
		var iframe = document.createElement('iframe');
		isShowingPlayer = true;
		iframe.id = 'colorFrame';
		container.appendChild(iframe);
		updateIframeContent();
	}

	window.onload = function() {
		createIframe();
	};
</script>

<body>
	<div class="container">
		<div class="text-container">
			<h1>nft folder webos</h1>
			<h1 id="launch"></h1>
			<h1 id="reLaunch"></h1>
			<h1 id="visibility"></h1>
		</div>
	</div>
</body>

</html>
