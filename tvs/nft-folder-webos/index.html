<!--
âˆ… lil org

Copyright (c) 2024 LG Electronics Inc.

SPDX-License-Identifier: Apache-2.0
-->

<!DOCTYPE html>
<html>

<head>
	<title>new app</title>
	<style type="text/css">
		body {
			width: 100%;
			height: 100%;
			background-color: #202020;
			margin: 0;
			padding: 0;
			overflow: hidden;
		}

		iframe {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			border: none;
		}

		.text-container {
			position: absolute;
			top: 10px;
			left: 10px;
			z-index: 1000;
		}

		h1 {
			color: #FFFFFF;
			margin: 5px 0;
		}

	</style>
</head>

<script src="webOSTVjs-1.2.10/webOSTV.js" charset="utf-8"></script>
<script src="webOSTVjs-1.2.10/webOSTV-dev.js" charset="utf-8"></script>
<script src="main.js" charset="utf-8"></script>
<script type="text/javascript">
	//sample code for calling LS2 API
	webOS.service.request("luna://com.palm.systemservice", {
		method: "clock/getTime",
		parameters: {},
		onSuccess: function (args) {
			console.log("UTC:", args.utc);
		},
		onFailure: function (args) {
			console.log("Failed to getTime");
		}
	});

	document.addEventListener(
		"webOSLaunch",
		function (inData) {
			var launchElement = document.getElementById("launch");
			launchElement.innerHTML = "launched";
		},
		true
	);

	document.addEventListener(
		"webOSRelaunch",
		function (inData) {
			var launchElement = document.getElementById("reLaunch");
			launchElement.innerHTML = "relaunched";
		},
		true
	);

	var hidden, visibilityChange;
	if (typeof document.hidden !== "undefined") {
		hidden = "hidden";
		visibilityChange = "visibilitychange";
	} else if (typeof document.webkitHidden !== "undefined") {
		hidden = "webkitHidden";
		visibilityChange = "webkitvisibilitychange";
	}

	document.addEventListener(
		visibilityChange,
		function () {
			if (document[hidden]) {
				var visibilityElement = document.getElementById("visibility");
				visibilityElement.innerHTML = "hidden";
				removeIframe();
			} else {
				var visibilityElement = document.getElementById("visibility");
				visibilityElement.innerHTML = "shown";
				createIframe();
			}
		},
		true
	);

	function updateIframeContent() {
		var iframe = document.getElementById('colorFrame');
		if (iframe) {
			fetchHtml('sample') // TODO: pass item
				.then(content => {
					if (content) {
						iframe.srcdoc = content;
					}
				});
		}
	}

	function removeIframe() {
		var iframe = document.getElementById('colorFrame');
		isShowingPlayer = false;
		if (iframe) {
			iframe.remove();
		}
	}

	var isShowingPlayer = false;

	function createIframe() {
		if (isShowingPlayer) { return; }
		if (document[hidden]) { return; }
		var iframe = document.createElement('iframe');
		isShowingPlayer = true;
		iframe.id = 'colorFrame';
		document.body.appendChild(iframe);
		updateIframeContent();
	}

	window.onload = function() {
		createIframe();
	};

	document.addEventListener(
		"keydown",
		function (event) {
			console.log("keydown", event.keyCode);
			// 37 left
			// 39 right
			// 13 center
			// 38 top
			// 40 bottom
			// 413 stop
			// 415 play
			// 19 pause
			// 412 back
			// 417 forward
			var keyCodeElement = document.getElementById("keyCode");
			var timestamp = new Date().toISOString();
			keyCodeElement.innerHTML = "key code: " + event.keyCode + "<br>" + timestamp;

			updateIframeContent(); // TODO: different updates for different keys
		},
		false
	);
</script>

<body>
	<div class="text-container">
		<h1>nft folder webos</h1>
		<h1 id="launch"></h1>
		<h1 id="reLaunch"></h1>
		<h1 id="visibility"></h1>
		<h1 id="keyCode"></h1>
	</div>
</body>

</html>
