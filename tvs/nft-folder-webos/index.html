<!--
∅ lil org

Copyright (c) 2024 LG Electronics Inc.

SPDX-License-Identifier: Apache-2.0
-->

<!DOCTYPE html>
<html>

<head>
	<title>⌐◨-◨</title>
	<meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no"
    />
    <link rel="stylesheet" href="./css/style.css" />
</head>

<script src="lib/webOSTV.js" charset="utf-8"></script>
<script src="lib/webOSTV-dev.js" charset="utf-8"></script>
<script src="lib/spatial_navigation.js"></script>
<script src="main.js" charset="utf-8"></script>
<script type="text/javascript">
	document.addEventListener(
		"webOSLaunch",
		function (inData) {
			console.log("webOSLaunch");
		},
		true
	);

	document.addEventListener(
		"webOSRelaunch",
		function (inData) {
			console.log("webOSRelaunch");
		},
		true
	);

	var hidden, visibilityChange;
	if (typeof document.hidden !== "undefined") {
		hidden = "hidden";
		visibilityChange = "visibilitychange";
	} else if (typeof document.webkitHidden !== "undefined") {
		hidden = "webkitHidden";
		visibilityChange = "webkitvisibilitychange";
	}

	document.addEventListener(
		visibilityChange,
		function () {
			if (document[hidden]) {
				removeIframe();
			} else {
				createIframe();
			}
		},
		true
	);

	function updateIframeContent() {
		var iframe = document.getElementById('colorFrame');
		if (iframe) {
			fetchHtml('sample') // TODO: pass item
				.then(content => {
					if (content) {
						iframe.srcdoc = content;
					}
				});
		}
	}

	function removeIframe() {
		var iframe = document.getElementById('colorFrame');
		isShowingPlayer = false;
		if (iframe) {
			iframe.remove();
		}
	}

	var isShowingPlayer = false;

	function createIframe() {
		// TODO: if showing player again after it was hidden, make sure to start with the same item
		if (isShowingPlayer) { return; }
		if (document[hidden]) { return; }
		var iframe = document.createElement('iframe');
		isShowingPlayer = true;
		iframe.id = 'colorFrame';
		document.body.appendChild(iframe);
		updateIframeContent();
	}

	window.onload = function() {
		createIframe();
	};

	document.addEventListener(
		"keydown",
		function (event) {
			console.log("keydown", event.keyCode);
			// 37 left
			// 39 right
			// 13 center
			// 38 top
			// 40 bottom
			// 413 stop
			// 415 play
			// 19 pause
			// 412 back
			// 417 forward
			updateIframeContent(); // TODO: different updates for different keys
		},
		false
	);
</script>

<body>
</body>

</html>
