!function(){"use strict";var t=Math.sin,e=Math.cos,s=Math.floor;const{floor:i,sqrt:n}=Math,r=(t,e,s)=>t[0]*e+t[1]*s,h=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]];var o=function(t=Math.random()){this.p=[...Array(256)].map((()=>i(256*t()))),this.pm=[...this.p,...this.p]};o.prototype.noise=function(t,e){const s=this.pm;var o,a,l=(t+e)*(.5*(n(3)-1)),c=i(t+l),f=i(e+l),u=(3-n(3))/6,d=(c+f)*u,p=t-(c-d),E=e-(f-d);p>E?(o=1,a=0):(o=0,a=1);var w=p-o+u,y=E-a+u,F=p-1+2*u,g=E-1+2*u,m=255&c,x=255&f,v=s[m+s[x]]%12,C=s[m+o+s[x+a]]%12,D=s[m+1+s[x+1]]%12,b=.5-p*p-E*E,A=.5-w*w-y*y,B=.5-F*F-g*g;return 70*((0>b?0:(b*=b)*b*r(h[v],p,E))+(0>A?0:(A*=A)*A*r(h[C],w,y))+(0>B?0:(B*=B)*B*r(h[D],F,g)))};class a{constructor(t,e,s,i,n=4){this.x=t,this.y=e,this.w=s,this.h=i,this.c=n,this.p=[],this.d=!1}sub(){const{x:t,y:e,h:s,w:i}=this;this.nw=new a(t,e,i/2,s/2,this.c),this.ne=new a(t+i/2,e,i/2,s/2,this.c),this.se=new a(t+i/2,e+s/2,i/2,s/2,this.c),this.sw=new a(t,e+s/2,i/2,s/2,this.c),this.d=!0}in(t){!1 in t||!1 in t||(this.p.length<this.c?this.p.push(t):(!this.d&&this.sub(),t.x<=this.x+this.w/2?t.y<=this.y+this.h/2?this.nw.in(t):this.sw.in(t):t.y<=this.y+this.h/2?this.ne.in(t):this.se.in(t)))}qr(t,e,s,i,n=[]){return t>this.x+this.w||t+s<this.x||e>this.y+this.h||e+i<this.y||(this.p.forEach((r=>{r.x>t&&r.x<t+s&&r.y>e&&r.y<e+i&&n.push(r)})),this.d&&(this.nw.qr(t,e,s,i,n),this.ne.qr(t,e,s,i,n),this.sw.qr(t,e,s,i,n),this.se.qr(t,e,s,i,n))),n}qc(t,e,s){return this.qr(t-s,e-s,2*s,2*s).filter((i=>{return n=i.x,r=i.y,(t-n)**2+(e-r)**2<=s*s;var n,r}))}forEach(t){1<=this.p.length&&this.p.forEach((e=>t(e))),this.d&&(this.nw.forEach(t),this.ne.forEach(t),this.se.forEach(t),this.sw.forEach(t))}clear(){delete this.nw,delete this.ne,delete this.se,delete this.sw}}const l=(t,e,i=.5)=>{function n(t){return parseInt(t,16)}let r=t=>t.replace(/#/g,""),h="#";for(var o=0;5>=o;o+=2){for(var a=n(r(t).substr(o,2)),l=n(r(e).substr(o,2)),c=s(l+(a-l)*i).toString(16);2>c.length;)c="0"+c;h+=c}return h},c=["#220122/#3E2B47/#4A369B/#6B46FF/#517DB0/#FF3CEB/#3BF3FF/Nebula","#272D02/#171E02/#36616A/#85984F/#088A9B/#E3BC30/#41AFFF/Winter forest","#082A5D/#001431/#1D3E6E/#286592/#47467B/#08F5C6/#5EC5FF/Terminal","#EFEDDF/#E8E0CE/#D9D7C4/#C0CBA8/#D6C690/#C16F4C/#737D57/Parched","#EEF1F3/#E5F2FC/#BEDDF5/#B4D9D2/#C0C9E0/#5A64B8/#1D9D8E/IKEA Showroom","#220122/#051623/#195F5C/#232853/#572F5E/#8E85F5/#4FD1CA/Witching hour"].map((t=>t.split("/"))),f=Math.PI,u=([s,i],n,r)=>[s+e(n)*r,i+t(n)*r],d=(t,e,s,i=0,n=1)=>(t-e)/(s-e)*(n-i)+i,p=420/594,E=(1*p).toFixed(2);var w=i=>{var n=Math.min,r=Math.max;const{range:h,value:w,chance:y,noise:F,bool:g,pick:m,weighted:x}=(t=>{const e=Uint32Array.from([0,0,0,0].map(((e,s)=>parseInt(t.substr(8*s+2,8),16)))),i=()=>{let t,s=e[3];return e[3]=e[2],e[2]=e[1],e[1]=t=e[0],s^=s<<11,s^=s>>>8,e[0]=s^t^t>>>19,e[0]/4294967296},n=(t=.5)=>i()<t,r=(t,e)=>i()*(e-t)+t,h=(t,e)=>s(r(t,e)),a=new o(i);return{value:i,chance:n,bool:n,range:r,rangeFloor:h,pick:t=>t.length?t[h(0,t.length)]:void 0,weighted:t=>{var e=t.reduce(((t,e)=>t+e)),s=i()*e;for(let e=0;e<t.length;e++){if(s<t[e])return e;s-=t[e]}return 0},noise:(t,e)=>(a.noise(t,e)+1)/2}})(i),v=[1/450,1/300,1/150,1/90][x([2,3,2,1])],C=v>=1/90,D=.033,b=6*v,A=C?v/8:v/4,B=m([2.6*v,3*v])+A,M=.4*v,q=h(1/16,1/8),k=y(.05),P=m(["Spiritual","Nature","Raw","Mystical"]),S=y(.008),R=y(.025),W=x([50,25,20,5])+1,I=g()?[.5,.5]:[h(D,.967),h(D,.967)],N=y(.05),T=h(0,.4),L=h(1/3,1.5),$=h(.8,2);let z=h(.15,.3);const H=h(0,f),K=h(0,(C?1:2)*f);let O=[h(-1,0),h(-1,0)],[U,j,G,J,Q,V,X,Y]=m(c);const Z=t=>{let e=t||m([U,j]),s=m([G,J,Q]),i=m([G,J,Q]),n=m([V,X]);const r=y(.2)?n:void 0;return s=r?l(e,r,.8):s,i=r?l(e,r,.6):i,n=r||n,[e,s,i,n]},_=t=>l(it,et,d(t,z,0,1,h(.1,.9)));let[tt,et,st,it]=Z();const nt=[[[[D,.5-E/2+D],[.967,.5+E/2-D]]],[[[D,.5-E/2+D],[.4835,.5+E/2-D]],[[.5165,.5-E/2+D],[.967,.5+E/2-D]]],[[[D,.5-E/2+D],[.3135,.5+E/2-D]],[[.33+.0165,.5-E/2+D],[.66-.0165,.5+E/2-D]],[[.6765,.5-E/2+D],[.967,.5+E/2-D]]],[[[D,.5-E/2+D],[.4835,.4835]],[[.5165,.5-E/2+D],[.967,.4835]],[[D,.5165],[.4835,.5+E/2-D]],[[.5165,.5165],[.967,.5+E/2-D]]]][W-1],rt=([t,e])=>F(t*L+O[0],e*L+O[1]),ht=([t,e])=>rt([t*$,e*$]);for(let t=0,e=0;4>=t||30>=e;){O[0]+=h(.25,.5),O[1]+=h(.25,.5),t=0;for(let i=0;100>i;i++){let n=i%10/10*.8+.1,r=s(i/10)/10*.8+.1;const h=ht([n,r]);h<=z/2?t+=1:h>=1-z/2&&(e+=1)}}const ot=(t,e)=>(([t,e],[s,i])=>{let n=(0,Math.atan2)(e-i,t-s);return 0>n&&(n+=2*f),n})(t,e)+(2*rt(e)-1)*T*f*2;let at=[],lt=new a(-.033,-.033,1.033,1.033);N&&lt.in({x:I[0],y:I[1]});const ct=([t,e],s=0)=>(([t,e])=>null==nt.find((([[s,i],[n,r]])=>t>=s&&t<=n&&e>=i&&e<=r)))([t,e])||0<lt.qc(t,e,s+B).length,ft=([t,e])=>{const s=ht([t,e]),i=d(s,z,1),n=g(),r=l([et,st][x([70,30])],[st,it,tt][x([i,1-i,i/2])],s),h=k?q:d(i,0,1,M,q);if(ct([t,e]))return;let o=[[t,e,r]],a=h,c=t,p=e;for(;0<a;){let t=rt([c,p]),e=N?ot(I,[c,p]):H+t*K+(n?f:0);const[i,h]=u([c,p],e,M);ct([c,p])?a=0:s<z?a-=5*M:(o.push([i,h,r]),c=i,p=h,a-=M)}1>o.length||(o.forEach((([t,e])=>lt.in({x:t,y:e}))),at=at.concat(o))},ut=([t,e],s,i)=>{let n=[];const r=d(i,z,0,b/2,b);let h=_(i),o=e-.3*r,a=e+.7*r,l=t-.4*r,c=t+.4*r;if(!(ct([t,e])||ct([t,o])||ct([t,a])||ct([l,e])||ct([c,e]))){for(let e=o;e<a;e+=M)n.push([t,e,h]);for(let t=l;t<=c;t+=M)n.push([t,e,h]);n.forEach((([t,e])=>lt.in({x:t,y:e}))),at=at.concat(n)}},dt=([t,e],s,i)=>{const n=d(i,z,0),h=r(.4*b,b*n);let o=_(i),a=[];if(ct([t,e],h-B))return;const[l,c]=u([0,0],f/4,M);[-1,1].forEach((s=>{let[i,n]=[t,e-h/2],r=0;for(;r<h&&!ct([i,n],h-B);)a.push([i,n,o]),r+=M,i+=l*s,n+=c})),a.forEach((([t,e])=>lt.in({x:t,y:e}))),at=at.concat(a)},pt=([s,i],h,o)=>{const a=d(o,z,0),l=v*(.6*a+.7)*4,c=N?ot(I,[s,i]):H+h*K,[p,E]=u([s,i],c+f,l);if(ct([s,i],l/2)||ct([p,E],l/4))return;let w=_(o),y=[[s+e(c+f)*l*.9,i+t(c+f)*l*.9,w]];for(let t=c+f/2;t<c+2.5*f;t+=2*f/(l*f/M*4)){const e=d(t-c-f/2,.25*f,.75*f,-1,1),h=n(1,r(0,1-Math.abs(e)));let[o,a]=u([s,i],t,l/2+l/3*h);y.push([o,a,w])}y.forEach((([t,e])=>lt.in({x:t,y:e}))),at=at.concat(y)},Et=([t,e],i,n)=>{const r=d(n,z,0),h=d(r,0,1,3*M,8*M);if(ct([t,e],h))return;const o=s(d(r,0,1,4,8));let a=_(n),l=[[t,e,a]];for(let s=H;s<=H+2*f;s+=2*f/o){let[i,n]=[t,e],r=0;for(const[t,e]=u([0,0],s,M);r<h&&!ct([i,n]);)l.push([i,n,a]),i+=t,n+=e,r+=M}l.forEach((([t,e])=>lt.in({x:t,y:e}))),at=at.concat(l)},wt=([t,e],s,i)=>{const n=[t,e,_(i)];y(2*i-1)||ct([t,e],3*v-B)||(lt.in({x:t,y:e}),at=at.concat([n,n]))};nt.forEach((([[t,e],[s,i]])=>{[tt,et,st,it]=Z(tt);for(let n=0;n<1e4/nt.length;n++){const n=[h(t,s),h(e,i)],r=rt(n),o=ht(n);if(o<=z){let t=P;S&&(t=m(["Spiritual","Nature","Raw","Mystical"])),R||y(.6)?"Spiritual"==t?ut(n,0,o):"Nature"==t?dt(n,0,o):"Raw"==t?pt(n,r,o):"Mystical"==t&&Et(n,0,o):wt(n)}else ft(n)}}));const yt=[],Ft=[],gt=[];for(let t=D+.01;t<.967;t+=.02)for(let e=.5-E/2+D+.01;e<=.5+E/2-D;e+=.02){const s=rt([t,e]),i=ht([t,e]),n=i<z?"#cc0000":"#444444";let r=N?ot(I,[t,e]):H+s*K;const[h,o]=u([t,e],r,1/80);yt.push([t,e,h,o,n]),Ft.push([t,e,n,1-i])}return(t,e,s,{lines:i,anomaly:r,output:h})=>{const o=([e,s],i)=>t.ellipse((e+w()*A)*c,(s+w()*A)*c,c*i,c*i,0,0,2*f),a=e=>t.fillStyle=e,l=n(e,s);a(h?tt:"#ddd"),t.fillRect(0,0,e,s),t.lineWidth=.1*l;let c=s/e<=p?s/p:e;t.translate(.5*(e-c),.5*(s-c)),r&&gt.forEach((([e,s,i,n,r])=>{t.save(),a(r),t.beginPath(),t.fillRect(e*c,s*c,i*c,n*c),t.restore()})),h&&at.forEach((([e,s,i="#fff"])=>{a(i);let n=1-.1*w();t.beginPath(),o([e,s],v*n),t.fill()})),i&&yt.forEach((([e,s,i,n,r])=>{t.strokeStyle=r,t.lineWidth=1/600*c,t.beginPath(),t.moveTo(e*c,s*c),t.lineTo(i*c,n*c),t.stroke()})),r&&Ft.forEach((([e,s,i,n])=>{t.globalAlpha=.3,a(i),t.beginPath(),o([e,s],n/100+1/600),t.fill()}))}};(()=>{let t=tokenData.hash,e=window,s=document;const i=s.body.appendChild(s.createElement("canvas")),n=i.getContext("2d");let r,h,o,a,l,c={lines:!1,anomaly:!1,output:!0,redraw:-1!==window.location.search.indexOf("animate")};const f=()=>{n.save(),n.scale(a,a),r(n,h,o,c),n.restore(),c.redraw&&requestAnimationFrame(d)},u=()=>{h=e.innerWidth,o=e.innerHeight,a=e.devicePixelRatio,i.width=~~(h*a),i.height=~~(o*a),i.style.width=`${h}px`,i.style.height=`${o}px`,r&&f()},d=t=>{void 0===l&&(l=t),250<t-l?(l=t,f()):requestAnimationFrame(d)};e.addEventListener("resize",u),e.addEventListener("keydown",(({key:t})=>{if("1"==t)c.lines=!c.lines;else if("2"==t)c.anomaly=!c.anomaly;else if("3"==t)c.output=!c.output;else{if("a"!=t)return;c.redraw=!c.redraw}f()})),u(),r=w(t),f()})()}();