{
  "kind" : "three",
  "screensaverFileName" : "undead.wyverns",
  "value" : "!function(){const t=0,e=1,n=new THREE.Vector3,s=new THREE.Line3,i=new THREE.Plane,r=new THREE.Vector3,o=new THREE.Triangle;class a{constructor(){this.normal=new THREE.Vector3,this.midpoint=new THREE.Vector3,this.area=0,this.constant=0,this.outside=null,this.mark=t,this.edge=null}static create(t,e,n){const s=new a,i=new l(t,s),r=new l(e,s),o=new l(n,s);return i.next=o.prev=r,r.next=i.prev=o,o.next=r.prev=i,s.edge=i,s.compute()}getEdge(t){let e=this.edge;for(;t>0;)e=e.next,t--;for(;t<0;)e=e.prev,t++;return e}compute(){const t=this.edge.tail(),e=this.edge.head(),n=this.edge.next.head();return o.set(t.point,e.point,n.point),o.getNormal(this.normal),o.getMidpoint(this.midpoint),this.area=o.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(t){return this.normal.dot(t)-this.constant}}class l{constructor(t,e){this.vertex=t,this.prev=null,this.next=null,this.twin=null,this.face=e}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const t=this.head(),e=this.tail();return null!==e?e.point.distanceTo(t.point):-1}lengthSquared(){const t=this.head(),e=this.tail();return null!==e?e.point.distanceToSquared(t.point):-1}setTwin(t){return this.twin=t,t.twin=this,this}}class h{constructor(t){this.point=t,this.prev=null,this.next=null,this.face=null}}class c{constructor(){this.head=null,this.tail=null}first(){return this.head}last(){return this.tail}clear(){return this.head=this.tail=null,this}insertBefore(t,e){return e.prev=t.prev,e.next=t,null===e.prev?this.head=e:e.prev.next=e,t.prev=e,this}insertAfter(t,e){return e.prev=t,e.next=t.next,null===e.next?this.tail=e:e.next.prev=e,t.next=e,this}append(t){return null===this.head?this.head=t:this.tail.next=t,t.prev=this.tail,t.next=null,this.tail=t,this}appendChain(t){for(null===this.head?this.head=t:this.tail.next=t,t.prev=this.tail;null!==t.next;)t=t.next;return this.tail=t,this}remove(t){return null===t.prev?this.head=t.next:t.prev.next=t.next,null===t.next?this.tail=t.prev:t.next.prev=t.prev,this}removeSubList(t,e){return null===t.prev?this.head=e.next:t.prev.next=e.next,null===e.next?this.tail=t.prev:e.next.prev=t.prev,this}isEmpty(){return null===this.head}}THREE.ConvexHull=class{constructor(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new c,this.unassigned=new c,this.vertices=[]}setFromPoints(t){!0!==Array.isArray(t)&&console.error(\"THREE.ConvexHull: Points parameter is not an array.\"),t.length<4&&console.error(\"THREE.ConvexHull: The algorithm needs at least four points.\"),this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.vertices.push(new h(t[e]));return this.compute(),this}setFromObject(t){const e=[];return t.updateMatrixWorld(!0),t.traverse(function(t){const n=t.geometry;if(void 0!==n){if(n.isGeometry)return void console.error(\"THREE.ConvexHull no longer supports Geometry. Use THREE.BufferGeometry instead.\");if(n.isBufferGeometry){const s=n.attributes.position;if(void 0!==s)for(let n=0,i=s.count;n<i;n++){const i=new THREE.Vector3;i.fromBufferAttribute(s,n).applyMatrix4(t.matrixWorld),e.push(i)}}}}),this.setFromPoints(e)}containsPoint(t){const e=this.faces;for(let n=0,s=e.length;n<s;n++)if(e[n].distanceToPoint(t)>this.tolerance)return!1;return!0}intersectRay(t,e){const n=this.faces;let s=-1\/0,i=1\/0;for(let e=0,r=n.length;e<r;e++){const r=n[e],o=r.distanceToPoint(t.origin),a=r.normal.dot(t.direction);if(o>0&&a>=0)return null;const l=0!==a?-o\/a:0;if(!(l<=0)&&(a>0?i=Math.min(l,i):s=Math.max(l,s),s>i))return null}return s!==-1\/0?t.at(s,e):t.at(i,e),e}intersectsRay(t){return null!==this.intersectRay(t,n)}makeEmpty(){return this.faces=[],this.vertices=[],this}addVertexToFace(t,e){return t.face=e,null===e.outside?this.assigned.append(t):this.assigned.insertBefore(e.outside,t),e.outside=t,this}removeVertexFromFace(t,e){return t===e.outside&&(null!==t.next&&t.next.face===e?e.outside=t.next:e.outside=null),this.assigned.remove(t),this}removeAllVerticesFromFace(t){if(null!==t.outside){const e=t.outside;let n=t.outside;for(;null!==n.next&&n.next.face===t;)n=n.next;return this.assigned.removeSubList(e,n),e.prev=n.next=null,t.outside=null,e}}deleteFaceVertices(t,e){const n=this.removeAllVerticesFromFace(t);if(void 0!==n)if(void 0===e)this.unassigned.appendChain(n);else{let t=n;do{const n=t.next;e.distanceToPoint(t.point)>this.tolerance?this.addVertexToFace(t,e):this.unassigned.append(t),t=n}while(null!==t)}return this}resolveUnassignedPoints(e){if(!1===this.unassigned.isEmpty()){let n=this.unassigned.first();do{const s=n.next;let i=this.tolerance,r=null;for(let s=0;s<e.length;s++){const o=e[s];if(o.mark===t){const t=o.distanceToPoint(n.point);if(t>i&&(i=t,r=o),i>1e3*this.tolerance)break}}null!==r&&this.addVertexToFace(n,r),n=s}while(null!==n)}return this}computeExtremes(){const t=new THREE.Vector3,e=new THREE.Vector3,n=[],s=[];for(let t=0;t<3;t++)n[t]=s[t]=this.vertices[0];t.copy(this.vertices[0].point),e.copy(this.vertices[0].point);for(let i=0,r=this.vertices.length;i<r;i++){const r=this.vertices[i],o=r.point;for(let e=0;e<3;e++)o.getComponent(e)<t.getComponent(e)&&(t.setComponent(e,o.getComponent(e)),n[e]=r);for(let t=0;t<3;t++)o.getComponent(t)>e.getComponent(t)&&(e.setComponent(t,o.getComponent(t)),s[t]=r)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(t.x),Math.abs(e.x))+Math.max(Math.abs(t.y),Math.abs(e.y))+Math.max(Math.abs(t.z),Math.abs(e.z))),{min:n,max:s}}computeInitialHull(){const t=this.vertices,e=this.computeExtremes(),n=e.min,o=e.max;let l=0,h=0;for(let t=0;t<3;t++){const e=o[t].point.getComponent(t)-n[t].point.getComponent(t);e>l&&(l=e,h=t)}const c=n[h],u=o[h];let d,p;l=0,s.set(c.point,u.point);for(let e=0,n=this.vertices.length;e<n;e++){const n=t[e];if(n!==c&&n!==u){s.closestPointToPoint(n.point,!0,r);const t=r.distanceToSquared(n.point);t>l&&(l=t,d=n)}}l=-1,i.setFromCoplanarPoints(c.point,u.point,d.point);for(let e=0,n=this.vertices.length;e<n;e++){const n=t[e];if(n!==c&&n!==u&&n!==d){const t=Math.abs(i.distanceToPoint(n.point));t>l&&(l=t,p=n)}}const f=[];if(i.distanceToPoint(p.point)<0){f.push(a.create(c,u,d),a.create(p,u,c),a.create(p,d,u),a.create(p,c,d));for(let t=0;t<3;t++){const e=(t+1)%3;f[t+1].getEdge(2).setTwin(f[0].getEdge(e)),f[t+1].getEdge(1).setTwin(f[e+1].getEdge(0))}}else{f.push(a.create(c,d,u),a.create(p,c,u),a.create(p,u,d),a.create(p,d,c));for(let t=0;t<3;t++){const e=(t+1)%3;f[t+1].getEdge(2).setTwin(f[0].getEdge((3-t)%3)),f[t+1].getEdge(0).setTwin(f[e+1].getEdge(1))}}for(let t=0;t<4;t++)this.faces.push(f[t]);for(let e=0,n=t.length;e<n;e++){const n=t[e];if(n!==c&&n!==u&&n!==d&&n!==p){l=this.tolerance;let t=null;for(let e=0;e<4;e++){const s=this.faces[e].distanceToPoint(n.point);s>l&&(l=s,t=this.faces[e])}null!==t&&this.addVertexToFace(n,t)}}return this}reindexFaces(){const e=[];for(let n=0;n<this.faces.length;n++){const s=this.faces[n];s.mark===t&&e.push(s)}return this.faces=e,this}nextVertexToAdd(){if(!1===this.assigned.isEmpty()){let t,e=0;const n=this.assigned.first().face;let s=n.outside;do{const i=n.distanceToPoint(s.point);i>e&&(e=i,t=s),s=s.next}while(null!==s&&s.face===n);return t}}computeHorizon(n,s,i,r){let o;this.deleteFaceVertices(i),i.mark=e,o=null===s?s=i.getEdge(0):s.next;do{const e=o.twin,s=e.face;s.mark===t&&(s.distanceToPoint(n)>this.tolerance?this.computeHorizon(n,e,s,r):r.push(o)),o=o.next}while(o!==s);return this}addAdjoiningFace(t,e){const n=a.create(t,e.tail(),e.head());return this.faces.push(n),n.getEdge(-1).setTwin(e.twin),n.getEdge(0)}addNewFaces(t,e){this.newFaces=[];let n=null,s=null;for(let i=0;i<e.length;i++){const r=e[i],o=this.addAdjoiningFace(t,r);null===n?n=o:o.next.setTwin(s),this.newFaces.push(o.face),s=o}return n.next.setTwin(s),this}addVertexToHull(t){const e=[];return this.unassigned.clear(),this.removeVertexFromFace(t,t.face),this.computeHorizon(t.point,null,t.face,e),this.addNewFaces(t,e),this.resolveUnassignedPoints(this.newFaces),this}cleanup(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this}compute(){let t;for(this.computeInitialHull();void 0!==(t=this.nextVertexToAdd());)this.addVertexToHull(t);return this.reindexFaces(),this.cleanup(),this}}}();THREE.ConvexGeometry=function(e){THREE.Geometry.call(this),this.fromBufferGeometry(new THREE.ConvexBufferGeometry(e)),this.mergeVertices()},THREE.ConvexGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ConvexGeometry.prototype.constructor=THREE.ConvexGeometry,THREE.ConvexBufferGeometry=function(e){THREE.BufferGeometry.call(this);var o=[],t=[];void 0===THREE.ConvexHull&&console.error(\"THREE.ConvexBufferGeometry: ConvexBufferGeometry relies on THREE.ConvexHull\");for(var r=(new THREE.ConvexHull).setFromPoints(e).faces,E=0;E<r.length;E++){var n=r[E],f=n.edge;do{var u=f.head().point;o.push(u.x,u.y,u.z),t.push(n.normal.x,n.normal.y,n.normal.z),f=f.next}while(f!==n.edge)}this.setAttribute(\"position\",new THREE.Float32BufferAttribute(o,3)),this.setAttribute(\"normal\",new THREE.Float32BufferAttribute(t,3))},THREE.ConvexBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype),THREE.ConvexBufferGeometry.prototype.constructor=THREE.ConvexBufferGeometry;\nconst Noise=function(t){null==t&&(t=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.p=[];for(var r=0;r<256;r++)this.p[r]=Math.floor(256*R.rbet(0,1));for(this.perm=[],r=0;r<512;r++)this.perm[r]=this.p[255&r];this.simplex=[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]};Noise.prototype.dot=function(t,r,i){return t[0]*r+t[1]*i},Noise.prototype.noise=function(t,r){var i,s,h=(t+r)*(.5*(Math.sqrt(3)-1)),o=Math.floor(t+h),e=Math.floor(r+h),p=(3-Math.sqrt(3))\/6,a=(o+e)*p,n=t-(o-a),m=r-(e-a);n>m?(i=1,s=0):(i=0,s=1);var d=n-i+p,f=m-s+p,l=n-1+2*p,u=m-1+2*p,M=255&o,c=255&e,g=this.perm[M+this.perm[c]]%12,v=this.perm[M+i+this.perm[c+s]]%12,N=this.perm[M+1+this.perm[c+1]]%12,q=.5-n*n-m*m,y=.5-d*d-f*f,b=.5-l*l-u*u;return 70*((q<0?0:(q*=q)*q*this.dot(this.grad3[g],n,m))+(y<0?0:(y*=y)*y*this.dot(this.grad3[v],d,f))+(b<0?0:(b*=b)*b*this.dot(this.grad3[N],l,u)))};\nclass Random{constructor(a){this.seed=a}rdec(){return this.seed^=this.seed<<13,this.seed^=this.seed>>17,this.seed^=this.seed<<5,(this.seed<0?~this.seed+1:this.seed)%1e3\/1e3}rbet(a,b){return a+(b-a)*this.rdec()}rint(a,b){return Math.floor(this.rbet(a,b+1))}rch(a){return a[Math.floor(this.rbet(0,.99*a.length))]}}const middlePoint=(a,b)=>new THREE.Vector3().addVectors(a,b).divideScalar(2),rotateAboutPoint=(a,c,d,e,b)=>{(b=void 0!==b&&b)&&a.parent.localToWorld(a.position),a.position.sub(c),a.position.applyAxisAngle(d,e),a.position.add(c),b&&a.parent.worldToLocal(a.position),a.rotateOnAxis(d,e)},pointHelper=(a,c=.01,d={})=>{let b=[];return a.forEach(e=>{let f=getMaterial(d?.color||\"#f00\"),g=new T.OctahedronGeometry(c,d.resolution||1),a=new T.Mesh(g,f);a.castShadow=!0,a.position.set(e.x,e.y,e.z),all.add(a),b.push(a)}),b},addConvexGeometry=(b,c=bonesColor)=>{let d=new T.ConvexGeometry(b),e=getMaterial(c),a=new T.Mesh(d,e);return all.add(a),a},addCorners=(a,b,c,d,e)=>(a.push(b.clone().add(d.clone().multiplyScalar(c))),a.push(b.clone().add(d.clone().multiplyScalar(-c))),a.push(b.clone().add(e.clone().multiplyScalar(c))),a.push(b.clone().add(e.clone().multiplyScalar(-c))),a),buildBone=(c,k,l=.025)=>{let j=new T.Group;all.add(j);let i,e,f=k.clone().sub(c).normalize(),d=new THREE.Vector3().crossVectors(f,new THREE.Vector3(0,1,0)).normalize(),g=new THREE.Vector3().crossVectors(f,d).normalize(),h=k.distanceTo(c),b=.01*h;b>.15&&(b=.15),b<l&&(b=l);let a=[];return a.push(c),a=addCorners(a,c,b,d,g),i=c.clone().add(f.clone().multiplyScalar(.05*h)),a=addCorners(a,i,1.5*b,d,g),e=c.clone().add(f.clone().multiplyScalar(.1*h)),a=addCorners(a,e,b,d,g),j.add(addConvexGeometry(a)),a=[],i=c.clone().add(f.clone().multiplyScalar(.1*h)),a=addCorners(a,i,b,d,g),e=c.clone().add(f.clone().multiplyScalar(.4*h)),a=addCorners(a,e,.6*b,d,g),j.add(addConvexGeometry(a)),a=[],i=c.clone().add(f.clone().multiplyScalar(.4*h)),a=addCorners(a,e,.6*b,d,g),e=c.clone().add(f.clone().multiplyScalar(.6*h)),a=addCorners(a,e,.6*b,d,g),j.add(addConvexGeometry(a)),a=[],i=c.clone().add(f.clone().multiplyScalar(.6*h)),a=addCorners(a,e,.6*b,d,g),e=c.clone().add(f.clone().multiplyScalar(.9*h)),a=addCorners(a,e,b,d,g),j.add(addConvexGeometry(a)),a=[],i=c.clone().add(f.clone().multiplyScalar(.9*h)),a=addCorners(a,i,b,d,g),e=c.clone().add(f.clone().multiplyScalar(.95*h)),a=addCorners(a,e,1.5*b,d,g),a=addCorners(a,k,b,d,g),j.add(addConvexGeometry(a)),j},buildSpineDisk=(c,k,l=0)=>{let i=new T.Group;all.add(i);let j,h,d=k.clone().sub(c).normalize(),e=new THREE.Vector3().crossVectors(d,new THREE.Vector3(0,1,0)).normalize(),f=new THREE.Vector3().crossVectors(d,e).normalize(),g=k.distanceTo(c),b=.05*g;b>.15&&(b=.15),b<.02&&(b=.02);let a=[];if(a.push(c),a=addCorners(a,c,.2*b,e,f),j=c.clone().add(d.clone().multiplyScalar(.05*g)),a=addCorners(a,j,b,e,f),h=c.clone().add(d.clone().multiplyScalar(.4*g)),a=addCorners(a,h,.6*b,e,f),i.add(addConvexGeometry(a)),a=[],j=c.clone().add(d.clone().multiplyScalar(.4*g)),a=addCorners(a,h,.6*b,e,f),h=c.clone().add(d.clone().multiplyScalar(.6*g)),a=addCorners(a,h,.6*b,e,f),i.add(addConvexGeometry(a)),a=[],j=c.clone().add(d.clone().multiplyScalar(.6*g)),a=addCorners(a,h,.6*b,e,f),h=c.clone().add(d.clone().multiplyScalar(.95*g)),a=addCorners(a,h,b,e,f),i.add(addConvexGeometry(a)),a=[],j=c.clone().add(d.clone().multiplyScalar(.95*g)),a=addCorners(a,j,b,e,f),a=addCorners(a,k,.2*b,e,f),l>0){let m=c.clone().add(d.clone().multiplyScalar(.5*g));buildSpike({origin:m,direction:f.multiplyScalar(-1),length:l})}return i.add(addConvexGeometry(a)),i},buildSegment=(b,c,d=.02,e={})=>{var f=new THREE.Vector3;f.subVectors(c,b).normalize();let g=b.distanceTo(c)*(e.lengthMod||1),h=getMaterial(),i=new T.CylinderGeometry(d\/2,d\/2,g,e.segments||8),a=new T.Mesh(i,h);return a.position.set(b.x,b.y,b.z),a.lookAt(c),a.rotateX(-PI\/2),a.position.add(f.clone().multiplyScalar(g\/2)),all.add(a),a},getMaterial=(a=\"#fff\",b={})=>new THREE.MeshPhongMaterial({color:a,flatShading:!0,...b}),distribute=(h,a,e)=>{let b=[];for(let f=0;f<a;f++)b.push(e);let c=h-e*a,d=0;for(;c>0;){let g=R.rbet(0,c);b[d]+=g,c-=g,++d>=a&&(d=0)}return b};function clamp(a,b,c){return a<b?b:a>c?c:a}function map(d,b,e,a,c){return clamp((d-b)*(c-a)\/(e-b)+a,a,c)}THREE.OrbitControls=function(e,t){var n,o,a,i,r,s;void 0===t&&console.warn('THREE.OrbitControls: The second parameter \"domElement\" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: \"document\" should not be used as the target \"domElement\". Please use \"renderer.domElement\" instead.'),this.object=e,this.domElement=t,this.enabled=!0,this.target=new THREE.Vector3,this.minDistance=0,this.maxDistance=1\/0,this.minZoom=0,this.maxZoom=1\/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1\/0,this.maxAzimuthAngle=1\/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:THREE.MOUSE.ROTATE,MIDDLE:THREE.MOUSE.DOLLY,RIGHT:THREE.MOUSE.PAN},this.touches={ONE:THREE.TOUCH.ROTATE,TWO:THREE.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return d.phi},this.getAzimuthalAngle=function(){return d.theta},this.saveState=function(){c.target0.copy(c.target),c.position0.copy(c.object.position),c.zoom0=c.object.zoom},this.reset=function(){c.target.copy(c.target0),c.object.position.copy(c.position0),c.object.zoom=c.zoom0,c.object.updateProjectionMatrix(),c.dispatchEvent(E),c.update(),l=h.NONE},this.update=(n=new THREE.Vector3,o=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),a=o.clone().invert(),i=new THREE.Vector3,r=new THREE.Quaternion,s=2*Math.PI,function(){var e=c.object.position;n.copy(e).sub(c.target),n.applyQuaternion(o),d.setFromVector3(n),c.autoRotate&&l===h.NONE&&A(2*Math.PI\/60\/60*c.autoRotateSpeed),c.enableDamping?(d.theta+=T.theta*c.dampingFactor,d.phi+=T.phi*c.dampingFactor):(d.theta+=T.theta,d.phi+=T.phi);var t=c.minAzimuthAngle,m=c.maxAzimuthAngle;return isFinite(t)&&isFinite(m)&&(t<-Math.PI?t+=s:t>Math.PI&&(t-=s),m<-Math.PI?m+=s:m>Math.PI&&(m-=s),d.theta=t<=m?Math.max(t,Math.min(m,d.theta)):d.theta>(t+m)\/2?Math.max(t,d.theta):Math.min(m,d.theta)),d.phi=Math.max(c.minPolarAngle,Math.min(c.maxPolarAngle,d.phi)),d.makeSafe(),d.radius*=b,d.radius=Math.max(c.minDistance,Math.min(c.maxDistance,d.radius)),!0===c.enableDamping?c.target.addScaledVector(O,c.dampingFactor):c.target.add(O),n.setFromSpherical(d),n.applyQuaternion(a),e.copy(c.target).add(n),c.object.lookAt(c.target),!0===c.enableDamping?(T.theta*=1-c.dampingFactor,T.phi*=1-c.dampingFactor,O.multiplyScalar(1-c.dampingFactor)):(T.set(0,0,0),O.set(0,0,0)),b=1,!!(f||i.distanceToSquared(c.object.position)>p||8*(1-r.dot(c.object.quaternion))>p)&&(c.dispatchEvent(E),i.copy(c.object.position),r.copy(c.object.quaternion),f=!1,!0)}),this.dispose=function(){c.domElement.removeEventListener(\"contextmenu\",F,!1),c.domElement.removeEventListener(\"pointerdown\",U,!1),c.domElement.removeEventListener(\"wheel\",_,!1),c.domElement.removeEventListener(\"touchstart\",Z,!1),c.domElement.removeEventListener(\"touchend\",V,!1),c.domElement.removeEventListener(\"touchmove\",I,!1),c.domElement.ownerDocument.removeEventListener(\"pointermove\",k,!1),c.domElement.ownerDocument.removeEventListener(\"pointerup\",x,!1),c.domElement.removeEventListener(\"keydown\",z,!1)};var c=this,E={type:\"change\"},m={type:\"start\"},u={type:\"end\"},h={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},l=h.NONE,p=1e-6,d=new THREE.Spherical,T=new THREE.Spherical,b=1,O=new THREE.Vector3,f=!1,R=new THREE.Vector2,H=new THREE.Vector2,g=new THREE.Vector2,v=new THREE.Vector2,L=new THREE.Vector2,P=new THREE.Vector2;function y(){return Math.pow(.95,c.zoomSpeed)}function A(e){T.theta-=e}function N(e){T.phi-=e}function w(e){c.object.isPerspectiveCamera?b\/=e:c.object.isOrthographicCamera?(c.object.zoom=Math.max(c.minZoom,Math.min(c.maxZoom,c.object.zoom*e)),c.object.updateProjectionMatrix(),f=!0):(console.warn(\"WARNING: OrbitControls.js encountered an unknown camera type - dolly\/zoom disabled.\"),c.enableZoom=!1)}function M(e){c.object.isPerspectiveCamera?b*=e:c.object.isOrthographicCamera?(c.object.zoom=Math.max(c.minZoom,Math.min(c.maxZoom,c.object.zoom\/e)),c.object.updateProjectionMatrix(),f=!0):(console.warn(\"WARNING: OrbitControls.js encountered an unknown camera type - dolly\/zoom disabled.\"),c.enableZoom=!1)}function D(e){R.set(e.clientX,e.clientY)}function C(e){if(1==e.touches.length)R.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);R.set(t,n)}}function j(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+n*n);v.set(0,o)}function Y(e){if(1==e.touches.length)H.set(e.touches[0].pageX,e.touches[0].pageY);else{var t=.5*(e.touches[0].pageX+e.touches[1].pageX),n=.5*(e.touches[0].pageY+e.touches[1].pageY);H.set(t,n)}g.subVectors(H,R).multiplyScalar(c.rotateSpeed);var o=c.domElement;A(2*Math.PI*g.x\/o.clientHeight),N(2*Math.PI*g.y\/o.clientHeight),R.copy(H)}function S(e){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY,o=Math.sqrt(t*t+n*n);L.set(0,o),P.set(0,Math.pow(L.y\/v.y,c.zoomSpeed)),w(P.y),v.copy(L)}function U(e){if(!1!==c.enabled)switch(e.pointerType){case\"mouse\":case\"pen\":!function(e){var t;switch(e.preventDefault(),c.domElement.focus?c.domElement.focus():window.focus(),e.button){case 0:t=c.mouseButtons.LEFT;break;case 1:t=c.mouseButtons.MIDDLE;break;case 2:t=c.mouseButtons.RIGHT;break;default:t=-1}switch(t){case THREE.MOUSE.DOLLY:if(!1===c.enableZoom)return;!function(e){v.set(e.clientX,e.clientY)}(e),l=h.DOLLY;break;case THREE.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===c.enablePan)return;l=h.PAN}else{if(!1===c.enableRotate)return;D(e),l=h.ROTATE}break;case THREE.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===c.enableRotate)return;D(e),l=h.ROTATE}else{if(!1===c.enablePan)return;l=h.PAN}break;default:l=h.NONE}l!==h.NONE&&(c.domElement.ownerDocument.addEventListener(\"pointermove\",k,!1),c.domElement.ownerDocument.addEventListener(\"pointerup\",x,!1),c.dispatchEvent(m))}(e)}}function k(e){if(!1!==c.enabled)switch(e.pointerType){case\"mouse\":case\"pen\":!function(e){if(!1===c.enabled)return;switch(e.preventDefault(),l){case h.ROTATE:if(!1===c.enableRotate)return;!function(e){H.set(e.clientX,e.clientY),g.subVectors(H,R).multiplyScalar(c.rotateSpeed);var t=c.domElement;A(2*Math.PI*g.x\/t.clientHeight),N(2*Math.PI*g.y\/t.clientHeight),R.copy(H),c.update()}(e);break;case h.DOLLY:if(!1===c.enableZoom)return;!function(e){L.set(e.clientX,e.clientY),P.subVectors(L,v),P.y>0?w(y()):P.y<0&&M(y()),v.copy(L),c.update()}(e);break;case h.PAN:if(!1===c.enablePan);}}(e)}}function x(e){switch(e.pointerType){case\"mouse\":case\"pen\":!function(e){if(c.domElement.ownerDocument.removeEventListener(\"pointermove\",k,!1),c.domElement.ownerDocument.removeEventListener(\"pointerup\",x,!1),!1===c.enabled)return;c.dispatchEvent(u),l=h.NONE}()}}function _(e){!1===c.enabled||!1===c.enableZoom||l!==h.NONE&&l!==h.ROTATE||(e.preventDefault(),e.stopPropagation(),c.dispatchEvent(m),function(e){e.deltaY<0?M(y()):e.deltaY>0&&w(y()),c.update()}(e),c.dispatchEvent(u))}function z(e){!1!==c.enabled&&!1!==c.enableKeys&&c.enablePan}function Z(e){if(!1!==c.enabled){switch(e.preventDefault(),e.touches.length){case 1:switch(c.touches.ONE){case THREE.TOUCH.ROTATE:if(!1===c.enableRotate)return;C(e),l=h.TOUCH_ROTATE;break;case THREE.TOUCH.PAN:if(!1===c.enablePan)return;l=h.TOUCH_PAN;break;default:l=h.NONE}break;case 2:switch(c.touches.TWO){case THREE.TOUCH.DOLLY_PAN:if(!1===c.enableZoom&&!1===c.enablePan)return;!function(e){c.enableZoom&&j(e)}(e),l=h.TOUCH_DOLLY_PAN;break;case THREE.TOUCH.DOLLY_ROTATE:if(!1===c.enableZoom&&!1===c.enableRotate)return;!function(e){c.enableZoom&&j(e),c.enableRotate&&C(e)}(e),l=h.TOUCH_DOLLY_ROTATE;break;default:l=h.NONE}break;default:l=h.NONE}l!==h.NONE&&c.dispatchEvent(m)}}function I(e){if(!1!==c.enabled)switch(e.preventDefault(),e.stopPropagation(),l){case h.TOUCH_ROTATE:if(!1===c.enableRotate)return;Y(e),c.update();break;case h.TOUCH_PAN:if(!1===c.enablePan)return;c.update();break;case h.TOUCH_DOLLY_PAN:if(!1===c.enableZoom&&!1===c.enablePan)return;!function(e){c.enableZoom&&S(e)}(e),c.update();break;case h.TOUCH_DOLLY_ROTATE:if(!1===c.enableZoom&&!1===c.enableRotate)return;!function(e){c.enableZoom&&S(e),c.enableRotate&&Y(e)}(e),c.update();break;default:l=h.NONE}}function V(e){!1!==c.enabled&&(c.dispatchEvent(u),l=h.NONE)}function F(e){!1!==c.enabled&&e.preventDefault()}c.domElement.addEventListener(\"contextmenu\",F,!1),c.domElement.addEventListener(\"pointerdown\",U,!1),c.domElement.addEventListener(\"wheel\",_,!1),c.domElement.addEventListener(\"touchstart\",Z,!1),c.domElement.addEventListener(\"touchend\",V,!1),c.domElement.addEventListener(\"touchmove\",I,!1),c.domElement.addEventListener(\"keydown\",z,!1),this.update()},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls,THREE.MapControls=function(e,t){THREE.OrbitControls.call(this,e,t),this.screenSpacePanning=!1,this.mouseButtons.LEFT=THREE.MOUSE.PAN,this.mouseButtons.RIGHT=THREE.MOUSE.ROTATE,this.touches.ONE=THREE.TOUCH.PAN,this.touches.TWO=THREE.TOUCH.DOLLY_ROTATE},THREE.MapControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.MapControls.prototype.constructor=THREE.MapControls;const seed=parseInt(tokenData.hash.slice(0,16),16),R=new Random(seed),scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(45,window.innerWidth\/window.innerHeight,.1,1e3);camera.position.set(0,0,2),camera.lookAt(0,0,0),camera.userData.currentY=0;const renderer=new THREE.WebGLRenderer({antialias:!0});renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(renderer.domElement);const T=THREE,V3=T.Vector3,PI=Math.PI,TAU=2*PI,BG_COLOR=\"#000\",PALETTES=[{name:\"Normal\",background:\"#222\",bones:\"#eee\",nest:\"#333\"},{name:\"Negative\",background:\"#fff\",bones:\"#310075\",nest:\"#fff\"},],LIGHT_COLORS=[{name:\"bumblebee\",hex:\"#fce205\"},{name:\"pumpkin\",hex:\"#ff7417\"},{name:\"candy apple\",hex:\"#ff0800\"},{name:\"taffy\",hex:\"#f987c5\"},{name:\"azure\",hex:\"#0080fe\"},{name:\"kelly\",hex:\"#4cbb17\"},{name:\"electric\",hex:\"#8f00ff\"}],CORE_TYPES=[{name:\"Fire\",color:\"#fc1303\"},{name:\"Earth\",color:\"#966200\"},{name:\"Water\",color:\"#006c96\"},{name:\"Ice\",color:\"#87dafa\"},{name:\"Thunder\",color:\"#ffe70a\"},{name:\"Forest\",color:\"#00f75b\"},{name:\"Metal\",color:\"#d9e4ff\"},{name:\"Magic\",color:\"#d666ff\"}];class Options{constructor(){this.hipW=.15,this.legLen=R.rbet(.8,1.6),this.legAngle=R.rbet(.2,1),this.spineLen=R.rbet(.4,.8),this.spineAngle=R.rbet(.8,1.5),this.wingSegLen=R.rbet(.3,.5),this.shoulderW=.3,this.wingAlpha=R.rch([-1,-0.75,-0.5,.25,.25,.5,.75,1]),this.wingBeta=R.rbet(.1,1.2),this.initialTailLen=R.rbet(.005,.01),this.tailSegments=64,this.tailDirection=R.rch([-1.1,1,1.1]),this.headLen=R.rbet(.3,.4),this.teethLength=R.rbet(.02,.05),this.rotationDirection=R.rch([-1,1]);let b=R.rbet(0,1),c=PALETTES.filter(a=>\"Negative\"!==a.name);b<.05?(this.invertedColors=!0,this.palette=R.rch(c)):b<.1?this.palette=PALETTES.find(a=>\"Negative\"===a.name):this.palette=R.rch(c);let a=R.rbet(0,1);this.numberHeads=a>.5?1:a>.2?2:a>.1?3:a>.02?4:5,4===this.numberHeads&&(this.headLen=.27),5===this.numberHeads&&(this.headLen=.25),this.leftLightColor=R.rch(LIGHT_COLORS),this.rightLightColor=R.rch(LIGHT_COLORS),this.core=R.rch(CORE_TYPES);let d=R.rbet(0,1);d>.5?this.species=\"wyvern\":d>.3?this.species=\"dragon\":this.species=\"drake\",\"drake\"===this.species&&(this.spineAngle=1),this.fingerLen=R.rbet(.1,.2),this.numFingers=R.rch([2,3,4]),this.hasBeak=R.rch([!0,!1,!1,!1]),this.hasHorns=R.rch([!0,!0,!1]),this.hasDorsalSpikes=R.rch([!0,!0,!1]),this.hasBackboneSpikes=R.rch([!0,!0,!0,!0,!1]),this.cameraDistance=R.rbet(4,5),this.cameraYDelta=R.rch([-2,-1,0,1,2])}}const options=new Options;console.log({options});const coreColor=options.invertedColors?options.palette.bones:options.core.color,bonesColor=options.invertedColors?options.core.color:options.palette.bones,near=4,far=10;scene.fog=new THREE.Fog(options.palette.background,4,10);const ambientLight=new THREE.HemisphereLight(\"white\",\"white\",.7);scene.add(ambientLight);const leftLight=new THREE.SpotLight(options.leftLightColor.hex,1);leftLight.position.set(2,2,0),scene.add(leftLight);const rightLight=new THREE.SpotLight(options.rightLightColor.hex,1);rightLight.position.set(-2,2,0),scene.add(rightLight);const bottomLight=new THREE.SpotLight(\"white\",1);bottomLight.position.set(0,-2,0),scene.add(bottomLight);let all=new T.Group;scene.add(all);const clearAll=()=>{for(var a=all.children.length-1;a>=0;a--)all.remove(all.children[a]);scene.remove(all)},buildLegs=a=>{let h=distribute(options.legLen,3,options.legLen\/4);a.leftLeg=[],a.rightLeg=[];let d=options.hipW\/2+.1;a.leftLeg.push(new V3(-d,0,0)),a.rightLeg.push(new V3(d,0,0));for(let b=0;b<3;b++){let e=a.leftLeg[b],f=h[b],g=b%2==0?1:-1;a.leftLeg.push(new V3(-d+.05*b,e.y+f*Math.sin(options.legAngle),e.z+g*f*Math.cos(options.legAngle))),a.rightLeg.push(new V3(d-.05*b,e.y+f*Math.sin(options.legAngle),e.z+g*f*Math.cos(options.legAngle)))}a.toes=[],buildHand(a.leftLeg[0],!0),buildHand(a.rightLeg[0],!0),buildBone(a.leftLeg[3],a.rightLeg[3]);for(let c=0;c<3;c++)buildBone(a.leftLeg[c],a.leftLeg[c+1]),buildBone(a.rightLeg[c],a.rightLeg[c+1]);return a.middleHip=new V3(0,a.leftLeg[3].y,a.leftLeg[3].z),a},buildArms=a=>{a.leftWing=[],a.rightWing=[],a.leftWing.push(new V3(-options.shoulderW\/2,a.neckBase.y,a.neckBase.z)),a.rightWing.push(new V3(options.shoulderW\/2,a.neckBase.y,a.neckBase.z));let b=R.rbet(PI-.2,PI+.2),c=options.legLen\/4;return a.leftWing.push(a.leftWing[0].clone().add(new V3(-0.1,c*Math.cos(b),c*Math.sin(b)))),a.rightWing.push(a.rightWing[0].clone().add(new V3(.1,c*Math.cos(b),c*Math.sin(b)))),a.leftWing.push(a.leftWing[1].clone().add(new V3(-0.1,.8*c*Math.cos(b+PI\/4),.8*c*Math.sin(b+PI\/4)))),a.rightWing.push(a.rightWing[1].clone().add(new V3(.1,.8*c*Math.cos(b+PI\/4),.8*c*Math.sin(b+PI\/4)))),buildBone(a.leftWing[0],a.leftWing[1]),buildBone(a.leftWing[1],a.leftWing[2]),buildBone(a.rightWing[0],a.rightWing[1]),buildBone(a.rightWing[1],a.rightWing[2]),buildHand(a.leftWing[2]),buildHand(a.rightWing[2]),a},buildSpine=(e,a,i)=>{let h=new T.Group,j=a.distanceTo(e),b=options.tailSegments\/4,k=j\/b,l=a.clone().sub(e).normalize(),f=e,c=i,g=0;for(let d=0;d<b;d++){d<.3*b?c*=1.15:c>.1&&(c-=.01),(a=f.clone().add(l.clone().multiplyScalar(k))).add(new V3(0,g,0)),d<b\/4?g-=.004:g+=.003;let m=buildSpineDisk(f,a,options.hasBackboneSpikes?c:0);h.add(m),f=a.clone()}return h},buildWings=a=>{a.leftWing=[],a.rightWing=[],a.leftWing.push(new V3(-options.shoulderW\/2,a.neckBase.y,a.neckBase.z)),a.rightWing.push(new V3(options.shoulderW\/2,a.neckBase.y,a.neckBase.z));for(let b=0;b<2;b++){let j=b%2==0?1:-1,g=0===b?.4:1,h=1===b?-TAU\/16:0;a.leftWing.push(new V3(a.leftWing[b].x-options.wingSegLen*Math.cos(options.wingBeta),a.leftWing[b].y-g*options.wingSegLen*Math.sin(options.wingAlpha+h),a.leftWing[b].z+j*g*options.wingSegLen*Math.cos(options.wingAlpha+h))),a.rightWing.push(new V3(a.rightWing[b].x+ +options.wingSegLen*Math.cos(options.wingBeta),a.rightWing[b].y-g*options.wingSegLen*Math.sin(options.wingAlpha+h),a.rightWing[b].z+j*g*options.wingSegLen*Math.cos(options.wingAlpha+h)))}for(let d=0;d<2;d++)buildBone(a.leftWing[d],a.leftWing[d+1]),buildBone(a.rightWing[d],a.rightWing[d+1]);let e=a.leftWing[2].clone(),f=a.rightWing[2].clone(),c=2.5,i=TAU\/4;for(let k=0;k<3;k++){let l=new V3(e.x-c*options.wingSegLen*Math.cos(options.wingBeta),e.y-c*options.wingSegLen*Math.sin(options.wingAlpha),e.z+c*options.wingSegLen*Math.cos(options.wingAlpha+i)),m=new V3(f.x+c*options.wingSegLen*Math.cos(options.wingBeta),f.y-c*options.wingSegLen*Math.sin(options.wingAlpha),f.z+c*options.wingSegLen*Math.cos(options.wingAlpha+i));i-=TAU\/4,buildSpike({origin:e,direction:l.clone().sub(e).normalize(),length:options.wingSegLen*c,curved:!0,radiusProp:.02}),buildSpike({origin:f,direction:m.clone().sub(f).normalize(),length:options.wingSegLen*c,curved:!0,radiusProp:.02})}return a},buildTail=(a,f)=>{a.tail=[],a.tail.push(a.middleHip);let c=f,g=-options.tailDirection*(options.spineAngle-TAU\/4),d=g;for(let b=0;b<options.tailSegments;b++){let e=options.initialTailLen*(options.tailSegments-b)*.2;a.tail.push(new V3(a.tail[b].x,a.tail[b].y-options.tailDirection*Math.sin(d)*e,a.tail[b].z+Math.cos(d)*e)),d+=.1*b*map(n.noise(.001*b,0),0,1,-TAU\/200,TAU\/200),c-=.002,c=c<0?0:c,buildSpineDisk(a.tail[b],a.tail[b+1],options.hasBackboneSpikes?c:0)}return a},buildHand=(c,h=!1)=>{let d=(options.numFingers-1)*PI*.15,i=1.5*PI-d\/2,j=d\/(options.numFingers-1);for(let a=0;a<options.numFingers;a++){let k=c,e=a*j+i,b=c.clone().add(new V3(Math.cos(e)*options.fingerLen,0,Math.sin(e)*options.fingerLen));buildSpineDisk(k,b);let f=new V3(0,-1,-0.6).normalize(),g=.7*options.fingerLen;if(buildSpike({origin:b,direction:f,length:g}),h){let l=b.clone().add(f.multiplyScalar(g));points.toes.push(l)}}},buildHead=(c,v,t,G=.1,H,I,J)=>{let d=new T.Group;all.add(d);let j=new T.Group;all.add(j);let K=c.neckBase.clone().sub(c.middleHip).normalize();c.headCenter=c.neckBase.clone().add(K.clone().multiplyScalar(options.headLen));let e=[],f=[],k=[],g=options.headLen\/5,a=c.headCenter.clone();for(let b=0;b<5;b++){let h=1===b?1.6:2===b?1.2:1,l=0===b?.8:1===b?1.2:4===b?.4:1,w=options.headLen\/2,x=4===b?.4:3===b?.6:1===b?1.2:1,y=new V3(a.x-w\/2*l,a.y,a.z-g*b*h),z=new V3(a.x+w\/2*l,a.y,a.z-g*b*h);if(e.push(y),e.push(z),4===b&&options.hasBeak){let L=middlePoint(y,z).add(new V3(0,-(.03*options.headLen),-(.12*options.headLen)));e.push(L)}let A=new V3(a.x-options.headLen\/6,a.y+options.headLen\/3*x,a.z-g*b*h),B=new V3(a.x+options.headLen\/6,a.y+options.headLen\/3*x,a.z-g*b*h);e.push(A),e.push(B);let M=middlePoint(A,B);e.push(M.clone().add(new V3(0,.05*options.headLen,.05*options.headLen)));let i=.07*options.headLen,C=4===b?-0.02:.02,q=0===b?options.headLen\/6:0,D=4===b?.03:0,m=[new V3(a.x-options.headLen\/6*l+C,a.y-options.headLen\/3+q,a.z-g*b*h),new V3(a.x-options.headLen\/6*l,a.y-options.headLen\/3+q,a.z-g*b*h+D),];extraLeftPoints=0===b?[m[0].clone().add(new V3(0,i+.03,-0.04)),m[1].clone().add(new V3(0,i+.03,-0.04)),]:[],f.push([m[0],m[1],m[0].clone().add(new V3(0,i,0)),m[1].clone().add(new V3(0,i,0)),...extraLeftPoints,]);let o=[new V3(a.x+options.headLen\/6*l-C,a.y-options.headLen\/3+q,a.z-g*b*h),new V3(a.x+options.headLen\/6*l,a.y-options.headLen\/3+q,a.z-g*b*h+D)];extraRightPoints=0===b?[o[0].clone().add(new V3(0,i+.03,-0.04)),o[1].clone().add(new V3(0,i+.03,-0.04)),]:[],k.push([o[0],o[1],o[0].clone().add(new V3(0,i,0)),o[1].clone().add(new V3(0,i,0)),...extraRightPoints,])}let N=buildHeadHoles(e),O=addConvexGeometry(e),r=[];for(let p=1;p<f.length;p++)r.push(addConvexGeometry([...f[p-1],...f[p]])),r.push(addConvexGeometry([...k[p-1],...k[p]]));for(let P of(r.push(addConvexGeometry([...f[f.length-1],...k[k.length-1]])),r))j.add(P);for(let s=0;s<f.length;s++){let u=f[s],E=k[s];for(let F=0;F<u.length;F++){let Q=middlePoint(u[2],u[3]);buildSpike({origin:Q,direction:new V3(0,1,0),length:options.teethLength,curved:!0,segments:1,radiusProp:.2,minRadius:.01,group:j});let S=middlePoint(E[2],E[3]);buildSpike({origin:S,direction:new V3(0,1,0),length:options.teethLength,curved:!0,segments:1,radiusProp:.2,minRadius:.01,group:j})}}j.position.y+=options.headLen\/10;let U=c.headCenter.clone().add(new V3(0,-options.headLen\/10,-options.headLen\/16));rotateAboutPoint(j,U,new V3(1,0,0),-G),options.hasHorns&&buildHeadSpikes(c.headCenter,d,H,I,J),d.add(O),d.add(j),d.add(N);let V=buildSpine(c.neckBase,c.headCenter);return d.add(V),t>0?(rotateAboutPoint(d,c.neckBase,new V3(1,0,0),t),rotateAboutPoint(d,c.neckBase,new V3(0,1,0),v)):(rotateAboutPoint(d,c.neckBase,new V3(0,1,0),v),rotateAboutPoint(d,c.neckBase,new V3(1,0,0),t)),c},buildHeadSpikes=(b,c,i,e,h)=>{let a=options.headLen,j=new V3(0,.3,1),f=new V3(-0.3,.2,1),g=new V3(.3,.2,1),d=h;if(!i&&h>a\/3&&(d=a\/3),e%2!=0){let k=b.clone().add(new V3(0,a\/4,-a\/8));buildSpike({origin:k,direction:j,length:d,curved:!0,radiusProp:.1,group:c})}if(e>=2){let l=b.clone().add(new V3(-(.1*a),a\/4,-a\/8)),m=b.clone().add(new V3(.1*a,a\/4,-a\/8));buildSpike({origin:l,direction:f,length:.6*d,curved:!0,radiusProp:.1,group:c}),buildSpike({origin:m,direction:g,length:.6*d,curved:!0,radiusProp:.1,group:c})}if(e>=4){let o=b.clone().add(new V3(-(.1*a),a\/8,-a\/8)),p=b.clone().add(new V3(.1*a,a\/8,-a\/8));buildSpike({origin:o,direction:f,length:.8*d,curved:!0,radiusProp:.05,group:c}),buildSpike({origin:p,direction:g,length:.8*d,curved:!0,radiusProp:.05,group:c})}if(e>=6){let q=b.clone().add(new V3(-(.1*a),a\/8,-a\/8)),r=b.clone().add(new V3(.1*a,a\/8,-a\/8));buildSpike({origin:q,direction:f.clone().add(new V3(0,-1,0)).normalize(),length:.6*a,curved:!0,radiusProp:.05,group:c}),buildSpike({origin:r,direction:g.clone().add(new V3(0,-0.8,0)).normalize(),length:.6*a,curved:!0,radiusProp:.05,group:c})}},buildSpike=({origin:q,direction:j,length:l,radiusProp:r=.1,segments:e=8,curved:s=!1,minRadius:m=.02,group:o})=>{let k=new THREE.Group;all.add(k);let p=l\/e,b=l*r;b<m&&(b=m);let d=q.clone();for(let f=0;f<e;f++){let a=[],g=j.clone().cross(new V3(0,0,1)).normalize(),i=j.clone().cross(g).normalize();a.push(d.clone().add(g.clone().multiplyScalar(b))),a.push(d.clone().add(g.clone().multiplyScalar(-b))),a.push(d.clone().add(i.clone().multiplyScalar(b))),a.push(d.clone().add(i.clone().multiplyScalar(-b)));let h=f===e-1?.4*b:b*(1-1\/e),c=d.clone().add(j.clone().normalize().multiplyScalar(p));s&&c.add(new V3(0,n.noise(.001*f,0),0)),a.push(c.clone().add(g.clone().multiplyScalar(h))),a.push(c.clone().add(g.clone().multiplyScalar(-h))),a.push(c.clone().add(i.clone().multiplyScalar(h))),a.push(c.clone().add(i.clone().multiplyScalar(-h))),f===e-1&&a.push(c.clone().add(new V3(0,.1*p,0)));let t=addConvexGeometry(a);k.add(t),d=c.clone(),b=h}o&&o.add(k)},buildHeadHoles=g=>{let a=options.headLen\/10,b=new T.Group;all.add(b);let c=[],e=middlePoint(g[4],g[6]).add(new V3(-options.headLen\/2.6,0,-0.045));c.push(e.clone().add(new V3(a\/2.5,1.5*a,0))),c.push(e.clone().add(new V3(-a\/3,-a,0))),c.push(e.clone().add(new V3(0,0,-a))),c.push(e.clone().add(new V3(0,a\/3,a))),c.push(e.clone().add(new V3(-a\/4,0,0))),b.add(addConvexGeometry(c,options.palette.background));let k=c.map(a=>new V3(-a.x,a.y,a.z));b.add(addConvexGeometry(k,options.palette.background));let d=[],f=middlePoint(g[10],g[12]);d.push(f.clone().add(new V3(0,a\/2,0))),d.push(f.clone().add(new V3(-a\/4,-a,0))),d.push(f.clone().add(new V3(0,0,-a))),d.push(f.clone().add(new V3(-a\/4,-a\/3,a))),d.push(f.clone().add(new V3(-a\/3,0,0))),b.add(addConvexGeometry(d,options.palette.background));let j=d.map(a=>new V3(-a.x,a.y,a.z));b.add(addConvexGeometry(j,options.palette.background));let h=addConvexGeometry(d,options.palette.background),i=addConvexGeometry(j,options.palette.background);h.position.z-=1.5*a,h.position.x+=a\/3,h.position.y-=a\/3,i.position.z-=1.5*a,i.position.x-=a\/3,i.position.y-=a\/3,b.add(h),b.add(i);let l=pointHelper([c],.02);return l.forEach(a=>{b.add(a)}),b},buildRibCage=b=>{let a=[],e=b.neckBase.clone().sub(b.middleHip).normalize(),c=e.clone().cross(new V3(1,0,0)).normalize();a.push(b.neckBase),a.push(b.leftWing[0].clone().add(new V3(-0.02,0,0))),a.push(b.rightWing[0].clone().add(new V3(.02,0,0)));let f=b.neckBase.clone().add(e.clone().multiplyScalar(-(.4*options.headLen))),g=b.neckBase.clone().add(e.clone().multiplyScalar(.3*options.headLen));a.push(f),a.push(g),a.push(g.clone().add(new V3(.07,0,.02))),a.push(g.clone().add(new V3(-0.07,0,.02))),a.push(f.clone().add(new V3(.05,0,0))),a.push(f.clone().add(new V3(-0.05,0,0)));let d=b.neckBase.clone().add(c.clone().multiplyScalar(-options.headLen\/5)),h=b.neckBase.clone().add(c.clone().multiplyScalar(options.headLen\/8)),i=b.neckBase.clone().add(c.clone().multiplyScalar(.1*options.headLen));pointHelper([i],.075,{color:coreColor}),options.hasDorsalSpikes&&(buildSpike({origin:d.clone().add(c.clone().multiplyScalar(.1)),direction:c.clone().multiplyScalar(-1).add(new V3(0,0,.6)).normalize(),length:.4,curved:!0}),buildSpike({origin:d.clone().add(c.clone().multiplyScalar(.1)),direction:c.clone().multiplyScalar(-1).add(new V3(-0.5,0,.6)).normalize(),length:.3,curved:!0}),buildSpike({origin:d.clone().add(c.clone().multiplyScalar(.1)),direction:c.clone().multiplyScalar(-1).add(new V3(.5,0,.6)).normalize(),length:.3,curved:!0})),a.push(d),a.push(h.clone().add(new V3(.05,0,0))),a.push(h.clone().add(new V3(-0.05,0,0))),addConvexGeometry(a)},buildMainPlatform=()=>{let b=points.leftLeg[0],c=points.rightLeg[0],e=middlePoint(b,c).add(new V3(0,.005,0)),f=b.distanceTo(c),d=[];for(let a=0;a<points.toes.length;a++){let g=points.toes[a];d.push(g)}buildPlatform(e,f,d)},buildPlatform=(a,b,i)=>{let c=[...i];c.push(a.clone().add(new V3(b\/4,0,0))),c.push(a.clone().add(new V3(-b\/4,0,0))),c.push(a.clone().add(new V3(0,-0.05,b\/2))),c.push(a.clone().add(new V3(0,-0.05,-b\/2))),a=a.add(new V3(0,-0.25,0));for(let d=0;d<20;d++){a=a.add(new V3(0,-0.05*d,0));let f=R.rint(3,7),g=TAU\/f;for(let e=0;e<f;e++){let j=R.rbet(0,1);if(j>.5){let k=b*Math.cos(g*e),l=b*Math.sin(g*e),m=a.clone().add(new V3(k,0,l));c.push(m.clone())}}let h=[1.05,1.1,1.1,1.1,1.1,1.25];d<10&&h.push(.5,.75);let o=R.rch(h);b*=o}addConvexGeometry(c,coreColor)},buildPlatforms=()=>{let d=points.leftLeg[0],e=points.rightLeg[0],f=middlePoint(d,e).add(new V3(0,-0.8,0)),a=R.rbet(.5,1),g=R.rbet(3,25),h=R.rbet(.05,.5),i=R.rbet(.01,.25),b=0;for(let c=0;c<g;c++){b+=TAU\/8;let j=a*Math.cos(b),k=a*Math.sin(b),l=f.clone().add(new V3(j,-c*i,k)),m=R.rbet(.3,.5);buildPlatform(l,m,[]),a+=h}},skyRadius=6,setPositionFromAngles=(b,a)=>{let c=6*Math.cos(b)*Math.sin(a),d=6*Math.sin(b)*Math.sin(a),e=6*Math.cos(a);return new V3(c,d,e)},centerAndRotate=b=>{let e=new V3(0,0,0),f=options.isDrake?b.leftWing[0].y:b.leftWing[1].y,g=b.headCenter.y,h=new V3(0,Math.max(f,g),0),a=middlePoint(e,h),c=R.rch([-1,-0.6,.6,1]);5===options.numberHeads&&(c=.3);let d=options.cameraDistance;camera.position.set(a.x+d*Math.sin(c),a.y+options.cameraYDelta,a.z-d),(controls=new THREE.OrbitControls(camera,renderer.domElement)).target.set(a.x,a.y,a.z),controls.minPolarAngle=PI\/8,controls.maxPolarAngle=PI\/2,controls.minDistance=2,controls.maxDistance=5},rebuild=()=>{clearAll(),build()};let points={base:new V3(0,0,0)},particles=[];const n=new Noise,build=()=>{renderer.setClearColor(options.palette.background,1),(points=buildLegs(points)).neckBase=new V3(0,points.middleHip.y+options.spineLen*Math.cos(options.spineAngle),points.middleHip.z-options.spineLen*Math.sin(options.spineAngle));let j=buildSpine(points.neckBase,points.middleHip,.05);all.add(j),\"wyvern\"!==options.species&&(points=buildArms(points)),\"drake\"!==options.species&&(points=buildWings(points)),points=buildTail(points,.05);let e=R.rbet(-0.1,.7),b=R.rbet(-0.1,.7),h=R.rbet(-0.1,.7),c=R.rint(1,7),f=R.rint(1,7),i=R.rint(1,7),d=R.rbet(.3*options.headLen,2*options.headLen),a=R.rbet(.3*options.headLen,2*options.headLen),g=R.rbet(-0.2,.2);1===options.numberHeads?points=buildHead(points,0,g,e,!0,c,d):2===options.numberHeads?(points=buildHead(points,-0.4,g,e,!0,c,d),points=buildHead(points,.4,g,b,!0,c,d)):3===options.numberHeads?(points=buildHead(points,-0.5,-0.2,b,!0,f,a),points=buildHead(points,0,0,e,!0,c,d),points=buildHead(points,.5,-0.2,b,!0,f,a)):4===options.numberHeads?(points=buildHead(points,-0.4,.2,e,!0,c,d),points=buildHead(points,.4,.2,e,!0,c,d),points=buildHead(points,-0.2,-0.6,b,!1,f,a),points=buildHead(points,.2,-0.6,b,!1,f,a)):5===options.numberHeads&&(points=buildHead(points,-0.3,.4,h,!0,f,a),points=buildHead(points,.3,.4,b,!0,f,a),points=buildHead(points,0,0,e,!0,c,d),points=buildHead(points,-0.3,-0.3,b,!1,i,a),points=buildHead(points,.3,-0.3,h,!1,i,a)),buildRibCage(points),buildMainPlatform(),addInitialParticles(),buildPlatforms(),centerAndRotate(points),scene.add(all)},maxParticlesY=5,addParticle=(b,c,d)=>{let a=pointHelper([new V3(b,c,d)],.01,{color:coreColor})[0];a.material.transparent=!0,a.material.opacity=.5,particles.push(a)},addInitialParticles=()=>{for(let a=0;a<100;a++){let b=R.rbet(-5,5),c=R.rbet(-5,5),d=R.rbet(-2,2);addParticle(b,d,c)}},animateParticles=()=>{let b=R.rbet(-1,-3);if(particles.length<200&&.25>R.rbet(0,1)){let c=R.rbet(-5,5),d=R.rbet(-5,5),e=b;addParticle(c,e,d)}for(let a of particles)a.position.x+=.005*n.noise(a.position.y,0),a.position.y+=.005,a.position.y>5&&(a.position.y=b)};function render(){controls.update(),renderer.render(scene,camera),animateParticles(),requestAnimationFrame(render,100)}build(),render()"
}