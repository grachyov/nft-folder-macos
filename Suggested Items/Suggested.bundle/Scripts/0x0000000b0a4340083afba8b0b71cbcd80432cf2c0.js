// 'One More Day' by Aaron Penne (2024)
const urlParams=new URLSearchParams(window.location.search);function generateRandomHash(){for(var randomHash="0x",i=0;i<64;i++){var randomNum=Math.floor(Math.random()*"0123456789abcdef".length);randomHash+="0123456789abcdef".substring(randomNum,randomNum+1)}return randomHash}"undefined"==typeof tokenData&&(tokenData={hash:generateRandomHash(),tokenId:"5"}),urlParams.get("hash")&&(tokenData.hash=urlParams.get("hash"));let infinite=!1;function stroke(ctx,c,lineWidth=1){ctx.strokeStyle=c,ctx.lineWidth=lineWidth,ctx.stroke()}function fill(ctx,c){ctx.fillStyle=c,ctx.fill()}function drawLine(ctx,x1,y1,x2,y2){ctx.beginPath(),ctx.moveTo(x1,y1),ctx.lineTo(x2,y2),ctx.closePath()}function drawRect(ctx,x,y,w,h){ctx.beginPath(),ctx.rect(x-w/2,y-h/2,w,h),ctx.closePath()}function drawCircle(ctx,x,y,r){ctx.beginPath(),ctx.arc(x,y,r,0,2*Math.PI),ctx.closePath()}function drawPolygon(ctx,points){ctx.beginPath(),ctx.moveTo(points[0][0],points[0][1]);for(let i=1;i<points.length;i++)ctx.lineTo(points[i][0],points[i][1]);ctx.closePath()}function drawSmoothPolygon(ctx,points,smoothness){if(!(points.length<3)){ctx.beginPath();for(let i=0;i<points.length;i++){var p0=0<i?points[i-1]:points[points.length-1],p1=points[i],p2=points[(i+1)%points.length],p3=points[(i+2)%points.length],cp1x=p1[0]+(p2[0]-p0[0])/smoothness,p0=p1[1]+(p2[1]-p0[1])/smoothness,cp2x=p2[0]-(p3[0]-p1[0])/smoothness,p3=p2[1]-(p3[1]-p1[1])/smoothness;0===i&&ctx.moveTo(p1[0],p1[1]),ctx.bezierCurveTo(cp1x,p0,cp2x,p3,p2[0],p2[1])}ctx.closePath(),ctx.fill()}}function titleCase(str){str=str.toLowerCase().split(" ");for(let i=0;i<str.length;i++)str[i]=str[i].charAt(0).toUpperCase()+str[i].slice(1);return str.join(" ")}function urlP(s){return urlParams.get(s)?lower(urlParams.get(s)):""}function lerp(a,b,t){return a+(b-a)*t}function mapRange(val,start1,stop1,start2,stop2){return(val-start1)/(stop1-start1)*(stop2-start2)+start2}function hexToRGBA(hex){let r=0,g=0,b=0,a=1;return 3===(hex=hex.replace(/^#/,"")).length?(r=parseInt(hex[0]+hex[0],16),g=parseInt(hex[1]+hex[1],16),b=parseInt(hex[2]+hex[2],16)):6!==hex.length&&8!==hex.length||(r=parseInt(hex.substring(0,2),16),g=parseInt(hex.substring(2,4),16),b=parseInt(hex.substring(4,6),16),8===hex.length&&(a=parseInt(hex.substring(6,8),16)/255)),[r,g,b,a]}function rgbToHSLA(r,g,b,a=1){r/=255,g/=255,b/=255;var max=Math.max(r,g,b),min=Math.min(r,g,b);let h,s,l=(max+min)/2,d=max-min;if(max===min)h=s=0;else{switch(s=.5<l?d/(2-max-min):d/(max+min),max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4}h=h/6*360}return[Math.round(h),Math.round(100*s),Math.round(100*l),a]}function hexToHSLA(hex){var[hex,g,b,a]=hexToRGBA(hex);return rgbToHSLA(hex,g,b,a)}function jitterHSLA(hex,jitterH=10,jitterS=10,jitterL=10,jitterA=0,style="uniform"){var[hex,s,l,a]=hexToHSLA(hex),style="gaussian"===style?rGaussian:rUniform;return hex+=style(0,jitterH),s+=style(0,jitterS),l+=style(0,jitterL),a+=style(0,jitterA),[(hex+360)%360,Math.max(0,Math.min(100,s)),Math.max(0,Math.min(100,l)),Math.max(0,Math.min(1,a))]}function modifyHSLA(hex,newH=null,newS=null,newL=null,newA=null){let[h,s,l,a]=hexToHSLA(hex);return null!==newH&&(h=newH),null!==newS&&(s=newS),null!==newL&&(l=newL),null!==newA&&(a=newA),h=(h+360)%360,s=Math.max(0,Math.min(100,s)),l=Math.max(0,Math.min(100,l)),a=Math.max(0,Math.min(1,a)),[h,s,l,a]}function colorString(c,colorspace="hsla"){return colorspace.startsWith("hsl")?4===c.length?`hsla(${c[0]}, ${c[1]}%, ${c[2]}%, ${c[3]})`:`hsl(${c[0]}, ${c[1]}%, ${c[2]}%)`:colorspace.startsWith("rgb")?4===c.length?`rgba(${c[0]}, ${c[1]}, ${c[2]}, ${c[3]})`:`rgb(${c[0]}, ${c[1]}, ${c[2]})`:(console.error("Unsupported color space"),null)}function blurCanvas(ctx,blurAmount){ctx.save(),ctx.filter=`blur(${blurAmount}px)`,ctx.drawImage(ctx.canvas,0,0),ctx.restore()}urlParams.get("infinite")&&(infinite=!0);let seed=gs(tokenData.hash);function gs(token){return parseInt(tokenData.hash.slice(0,16),16)}function rd(){return((seed=(seed=(seed^=seed<<13)^seed>>17)^seed<<5)<0?1+~seed:seed)%1e3/1e3}function rb(a,b){return a+(b-a)*rd()}function rc(choices,n=1){var result=[],availableChoices=[...choices];for(let i=0;i<n;i++){var index=Math.floor(rb(0,availableChoices.length));result.push(availableChoices[index]),availableChoices.splice(index,1)}return 1===n?result[0]:result}function rco(choices){let a=[];return choices.forEach((elem,idx)=>{for(let i=0;i<elem.w;i++)a.push(elem)}),rc(a)}function gj(a,name,val=!1){let out=a.filter(({n})=>n==name);return val?[...out=out.map(({v})=>v)]:out[0]}function rUniform(mean,sd){return rb(mean-sd,mean+sd)}function rGaussian(mean,sd,method,span=1){if("fake"===method)return mapRange(rd()-rd(),-1,1,mean-sd,mean+sd);if("old"===method){let rdiff=rd()-rd();return mapRange(rdiff,-span,span,0,sd)}{let u=0,v=0;for(;0===u;)u=rd();for(;0===v;)v=rd();return Math.sqrt(-2*Math.log(u))*Math.cos(2*Math.PI*v)*sd+mean}}function shuffle(a){for(let i=a.length-1;0<i;i--){var j=Math.floor(rd()*(i+1));[a[i],a[j]]=[a[j],a[i]]}}function getDim(){var w=innerWidth,h=innerHeight,pd=devicePixelRatio;return{w:w*pd,h:h*pd,mn:Math.min(w,h)*pd,mx:Math.max(w,h)*pd,pd:pd,w2:w*pd/2,h2:h*pd/2,mn2:Math.min(w,h)/2*pd,mx2:Math.max(w,h)/2*pd,avg:(w+h)/2*pd}}function resize(){dim=getDim(),cnv.width=dim.w,cnv.height=dim.h,cnv.style.width=dim.w/dim.pd+"px",cnv.style.height=dim.h/dim.pd+"px"}function keydown(event){"r"===event.key?location.reload():"s"===event.key||"d"===event.key?downloadCanvas():"v"===event.key?toggleRecording():event.key}function click(event){let clientX,clientY;clientY=(event.touches&&0<event.touches.length?(clientX=event.touches[0].clientX,event.touches[0]):(clientX=event.clientX,event)).clientY;var{width:event,height}=cnv.getBoundingClientRect();clientX>event/2&&clientY<height/2?location.reload():clientX>event/2&&clientY>height/2?downloadCanvas():clientX<event/2&&clientY>height/2||(debug=!debug)}function getTimestamp(){return(new Date).toISOString().replace(/[^T0-9]/g,"").replace("T","_")}function getFilename(){return`${scriptTitle}_${tokenData.hash}_`+getTimestamp()}function downloadCanvas(){var link=document.createElement("a");link.download=getFilename()+".png",link.href=cnv.toDataURL("image/png"),link.click(),console.log("downloaded image: "+link.download)}const cw="#F2F3EE",cb="#151c1f";let zephyrBg=["#8F3935","#336655","#335588","#CC9999","#4C3F5D"],zephyrPal=["#4E6E61","#336655","#4C3F5D","#333366","#335588","#4455AA","#557766","#5493B6","#77AACC","#89292D","#8877AA","#8F3935","#AA3333","#B8513B","#BB7788","#CC5544","#CC9955","#D57C30","#DD9944","#DDAA99","#CC9999","#DEC254"],palette=[{w:0,n:"Darkness",v:["#E8E2D6","#656463","#333","#111","#F3F3EF","#000"]},{w:5,n:"Zephyr",v:zephyrPal},{w:1,n:"Laguna",v:["#cee","#9bc","#099","#78cdd0"]},{w:10,n:"Three Fates",v:rc(zephyrPal,3)},{w:1,n:"Bacon",v:["#89292D","#AA3333","#7A0000","#7A2B2A","#863A39","#A13A34"]},{w:1,n:"Riley",v:["#E8E2D6","#656463","#333","#111","#F3F3EF","#000"]},{w:1,n:"South Beach",v:["#78cdd0","#fdd4bd","#253122","#f9c1ce"]},{w:1,n:"Slayer",v:["#6d4145","#ca92a8","#713b4c","#f9c1ce"]},{w:3,n:"Young Again",v:["#a36aa5","#006eb8","#fcb315","#e31f26"]},{w:1,n:"Thaddeus",v:["#064f6e","#f68c50","#40456a","#f3a257"]},{w:1,n:"Basil Gogos",v:["#2a272f","#2a2a2b","#523654","#6f2253","#69568e","#6d7e9f","#655b93","#6e4f8b","#5f385c","#886177","#c8c7c7","#000000","#c0c0be","#dedfd9","#9bbcaa","#67395d","#76385f","#763b5e","#8db4ac","#322c36","#797b7a","#4f5052","#3a3b3d","#696a6a","#b6b7b4","#aac4ab","#6f395e","#989a97","#616263","#63395d","#37303e","#1e1d22","#666f9b","#7a3d6d","#443349","#75375d","#754b87","#799aa8","#3d3041","#beccba","#b9b9b7","#7e417b","#49344d","#888a89","#242327","#18181a","#a8aaa7","#4a4b4d","#515254","#c7d1c1","#342e3b","#738ca3","#424344","#87afad","#a0a19f","#b4c8b2","#4d3551","#626198","#212125","#7c4683","#75375c","#717372","#323335","#3f4042","#2e2e30","#595b5a","#27242b","#3f3245","#2e2933","#94b8aa","#b0b1af","#202022","#d6d5d6","#a2c0aa","#27282a","#6a395e","#5c3859","#909290","#1a1a1c","#47484a","#171718","#583757","#d2d2d2","#cfd2c8","#80a6ab","#808281","#37383a","#2f3032","#73385c"]},{w:3,n:"Lemon",v:["#a68776","#c0b9c6","#004990","#e7dccf","#ebcde0","#e0acc7","#003759","#c6caaa","#001a75","#acdaf3","#debcdf","#b1d6db","#a1775f","#583b86","#000000","#cab3ac","#d7c3d6","#d25243","#795a99","#433f85","#e5e5ec","#573f41","#b0d6e8","#e7a100","#d2a793","#453c7a","#f1f2c1","#a3795c","#a4d5ea","#a0d3f1","#aed5e0","#e8c9da","#dbbb7f","#a78275","#c75b55","#370077","#f7d3e5","#005495","#494984","#eb9f00","#b5d5ed","#b4dbd5","#f7d6e6","#a5a0a2","#edf5f5","#efc945","#b8d3eb","#abd6f0","#d1c596","#c7e7ed","#e5cf8a","#d5c5c0","#e3712e","#d8bc73","#e1c3cf","#eeefda","#e6a90f","#886899","#f4f8f8","#cbd5b2","#abd4eb","#b2a2be","#67478b","#618dc2","#f4f1f5","#bed2e0","#bd6a6e","#ebdbcc","#97d2d2","#d8d5c9","#839fbb","#e0524c","#e5a400","#3b0071","#b6cdd6","#e1bcc7","#48437f","#5e376c","#554752","#efc82a","#9bc8e8","#ddabbd","#009ea1","#aed7ed","#b1dcec","#f4b6ca","#f7d5e9","#f6f8f3","#d83c32","#6286b8","#bfd0d6","#dad6e6","#c9a2ab","#009ba0","#dabcdc","#806197","#00116e","#789ea6","#e16c2c","#9abbe2"]},{w:2,n:"Halcyon",v:["#756485","#835061","#9A95A0","#B6A5C8","#9B85A2","#835061","#C58FAD","#BC849E","#883E3F","#BD636E","#CF707D","#703946","#8C495C","#B9627D","#683D4D","#3F2D39","#7F4364","#5E3750","#252830","#4A354F","#3A2D3E","#1E231D","#242525","#212322","#1C211E","#2E272D","#42303D","#26262D","#482F37","#7B4048","#4C3037","#442F35","#A9554E","#9C4E47","#4E282B","#B26A53","#CE7C5D","#884331","#9A605B","#C48A8C","#A06B6A","#714A4F","#A88DB1","#A38AAE","#594662","#B1A9B4","#242525","#212322","#1C211E"]}];console.log("'One More Day' by Aaron Penne (2024)"),console.log("Token Hash: "+tokenData.hash),console.log("Token ID: "+tokenData.tokenId);const span=2;let frameCount=0,loopCount=0;const fcMax=100,numLoops=16;let numDrips=400;const numLines=20;let drips=[],dripsOG=[],circles=[],colors=[],pp={bg:[{w:15,n:"Light",v:cw},{w:25,n:"Dark",v:cb},{w:10,n:"Color Sync",v:rc(zephyrBg)}],fg:[{w:0,n:"Light",v:cw},{w:0,n:"Dark",v:cb}],circleColors:[{w:0,n:"None",v:0},{w:15,n:"Multiple",v:0},{w:1,n:"Monochrome",v:0}],circleCount:[{w:0,n:"None",v:100},{w:15,n:"Few",v:20},{w:1,n:"Many",v:7}],dripPattern:[{w:1,n:"Centered",v:1}],linePattern:[{w:38,n:"Centered",v:1},{w:8,n:"Random",v:3},{w:2,n:"Horizontal",v:4},{w:2,n:"Vertical",v:5}],circlePattern:[{w:7,n:"None",v:0},{w:35,n:"Centered",v:1},{w:8,n:"Spread",v:2}],holyGlow:[{w:1,n:"False",v:!1},{w:5,n:"True",v:!0}],composition:[{w:47,n:"Explosion",v:1},{w:3,n:"Dark Matter",v:4}],pal:palette},p={};for(let key in pp)p[key]=rco(pp[key]);"0"==tokenData.tokenId.toString()&&(p.composition=gj(pp.composition,"Explosion"),p.pal=gj(pp.pal,"Lemon"),p.bg=gj(pp.bg,"Light"),p.holyGlow=gj(pp.holyGlow,"False")),"Explosion"===p.composition.n?p.dripPattern=gj(pp.dripPattern,"Centered"):"Dark Matter"===p.composition.n&&(p.dripPattern=gj(pp.dripPattern,"Centered"),p.linePattern=gj(pp.linePattern,"Centered"),p.circlePattern=gj(pp.circlePattern,"Centered"),p.holyGlow=gj(pp.holyGlow,"True"),p.bg=gj(pp.bg,"Dark"),p.pal=gj(pp.pal,"Darkness")),"None"===p.circlePattern.n&&(p.circleColors=gj(pp.circleColors,"None"),p.circleCount=gj(pp.circleCount,"None")),"Color Sync"===p.bg.n&&(p.fg=gj(pp.fg,"Light"),p.pal=gj(pp.pal,"Zephyr")),"Light"===p.bg.n&&(p.fg=gj(pp.fg,"Dark")),"Dark"===p.bg.n&&(p.fg=gj(pp.fg,"Light"));const cnv=document.querySelector("canvas"),ctx=cnv.getContext("2d");let dim=getDim(),{w,h,pd,w2,h2,mn,mx,mn2,mx2,avg}=dim;document.body.style.background=p.bg.v,drawRect(ctx,0,0,2*w,8*h),fill(ctx,p.bg.v);for(let i=0;i<numDrips;i++){let c,x,y;x=mapRange(rd()-rd(),-span,span,0,w),y=mapRange(rd()-rd(),-span,span,0,h),(pct=rd())<.7?c=rc(p.pal.v):pct<.9?c=p.bg.v:(c=p.fg.v,"Color Sync"===p.bg.n&&(c=rd()<.3?cb:cw)),colors[i]=c,drips[i]={x:x,y:y},dripsOG[i]={x:x,y:y},"Centered"===p.circlePattern.n?circles[i]={x:w2,y:h2}:"Spread"===p.circlePattern.n&&(circles[i]={x:x,y:y})}function draw(){fc=frameCount%fcMax;var rDrip=lerp(.003*avg,3e-4*avg,fc/fcMax);for(let i=0;i<numDrips;i++){var dd=avg/(i+1),sw=avg*rb(5e-4,.003);drips[i].x,drips[i].y;if(p.holyGlow.v&&frameCount%3==0&&frameCount<fcMax*numLoops*.97&&(a=drips[i],b={x:w2,y:h2},0<=a.x)&&a.x<=w&&0<=a.y&&a.y<=h&&(drawLine(ctx,a.x,a.y,b.x,b.y),stroke(ctx,"#ffffff09",.001*avg)),frameCount%(.6*fcMax)==0&&i%10==0){let a=drips[i],b=dripsOG[i];var length,angle;colors[i];"Centered"===p.linePattern.n?(innerR=rb(.2,.7),a=drips[i],b={x:lerp(w2,drips[i].x,innerR),y:lerp(h2,drips[i].y,innerR)}):"Random"===p.linePattern.n?(p.fg.v,length=.1*dim.avg,a={x:drips[i].x,y:drips[i].y},angle=2*Math.random()*Math.PI,b={x:a.x+length*Math.cos(angle),y:a.y+length*Math.sin(angle)}):"Horizontal"===p.linePattern.n?(a={x:drips[i].x,y:drips[i].y},b={x:rb(0,w),y:drips[i].y}):"Vertical"===p.linePattern.n&&(a={x:drips[i].x,y:drips[i].y},b={x:drips[i].x,y:rb(0,h)}),drawLine(ctx,a.x,a.y,b.x,b.y),stroke(ctx,colorString(jitterHSLA(colors[i],10,0,0,0)),sw)}if("None"!=p.circlePattern.n&&i%p.circleCount.v==0){let x=circles[i].x,y=circles[i].y,r=0,c=colors[i];"Centered"===p.circlePattern.n&&frameCount%(5*fcMax)==0?(length=.04*avg,x=circles[i].x+rb(-length,length),y=circles[i].y+rb(-length,length),r=avg*i/numDrips):"Spread"===p.circlePattern.n&&frameCount%(2*fcMax)==0&&(x=circles[i].x,y=circles[i].y,r=avg*rb(.01,.05)),drawCircle(ctx,x,y,r),"Monochrome"===p.circleColors.n&&(c=p.fg.v),stroke(ctx,colorString(jitterHSLA(c,10,0,0,0)),sw)}drawCircle(ctx,drips[i].x,drips[i].y,rDrip),"Dark Matter"===p.composition.n?fill(ctx,p.bg.v):fill(ctx,colorString(jitterHSLA(colors[i],10,0,0,0))),angle=drips[i].x+rb(-dd,dd),sw=drips[i].y+rb(-dd,dd),drips[i]={x:angle,y:sw}}fc==fcMax-1&&loopCount++,(frameCount+1)%(fcMax*numLoops)!=0||infinite?requestAnimationFrame(draw):(console.log(frameCount+" frames"),console.log(numDrips*frameCount+" dots")),ctx.beginPath(),frameCount++}document.addEventListener("keydown",keydown),cnv.addEventListener("click",click),resize(),drawRect(ctx,0,0,2*w,8*h),fill(ctx,p.bg.v),draw();